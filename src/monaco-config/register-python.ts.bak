/**
 * –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Python –≤ Monaco Editor
 */

import * as monaco from 'monaco-editor';
import { invoke } from '@tauri-apps/api/core';
import { 
  updateAllPythonDiagnostics, 
  isPythonLSPConnected, 
  forcePythonDiagnosticsUpdate,
  clearAllPythonDiagnostics
} from '../main-screen/centerContainer/python-lsp-starter';
import { MonacoLSPDiagnostics } from '../main-screen/centerContainer/monaco-lsp-diagnostics';
import { loadPylanceFromCDN, PylanceAPI } from './pylance-loader';

interface IPythonDiagnostic {
  severity: 'error' | 'warning' | 'info';
  message: string;
  line: number;
  column: number;
  endLine: number;
  endColumn: number;
  source: string;
}

interface IPythonMarker extends monaco.editor.IMarkerData {
  owner: string;
  resource: monaco.Uri;
}

// –û–±—ä—è–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏
declare global {
  interface Window {
    updatePythonDiagnostics?: (filePath?: string) => Promise<string>;
    registerPythonForModel?: (model: monaco.editor.ITextModel) => void;
    forceUpdateAllDecorations?: () => void;
    setupErrorDecorations?: (editor: any) => void;
    setupAllErrorDecorations?: () => void;
    globalMarkersStore?: Map<string, any[]>;
    monaco?: any;
    pythonDiagnosticsStore?: any;
    pylance?: any;
    globalMarkers?: Map<string, any[]>;
    applyNoLineWrap?: (editor: any) => void;
  }
}

// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è pip –ø–∞–∫–µ—Ç–æ–≤
interface PipPackage {
  name: string;
  version: string;
}

// –ö—ç—à pip –ø–∞–∫–µ—Ç–æ–≤
let pipPackagesCache: PipPackage[] = [];
let pipPackagesLoaded = false;

/**
 * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö pip –ø–∞–∫–µ—Ç–æ–≤
 */
async function loadPipPackages(): Promise<PipPackage[]> {
  if (pipPackagesLoaded && pipPackagesCache.length > 0) {
    return pipPackagesCache;
  }

  try {
    console.log('–ó–∞–≥—Ä—É–∑–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö pip –ø–∞–∫–µ—Ç–æ–≤...');
    const packages = await invoke<PipPackage[]>('get_pip_packages');
    pipPackagesCache = packages;
    pipPackagesLoaded = true;
    console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${packages.length} pip –ø–∞–∫–µ—Ç–æ–≤`);
    return packages;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ pip –ø–∞–∫–µ—Ç–æ–≤:', error);
    return [];
  }
}

// –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
let lastMarkersCache = new Map();
// –¢–∞–π–º–µ—Ä—ã –¥–ª—è –¥–µ–±–∞—É–Ω—Å–∏–Ω–≥–∞ –¥–µ–∫–æ—Ä–∞—Ü–∏–π
let decorationTimers = new Map();
// –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤—Å–µ—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –≤—Å–µ—Ö URI
let globalMarkers = new Map();

function mapSeverityToMonaco(severity: string): monaco.MarkerSeverity {
  switch (severity) {
    case 'error':
      return monaco.MarkerSeverity.Error;
    case 'warning':
      return monaco.MarkerSeverity.Warning;
    case 'info':
      return monaco.MarkerSeverity.Info;
    default:
      return monaco.MarkerSeverity.Warning;
  }
}

function createMarkerData(diagnostic: IPythonDiagnostic): monaco.editor.IMarkerData {
  return {
    severity: mapSeverityToMonaco(diagnostic.severity),
    message: diagnostic.message,
    startLineNumber: diagnostic.line,
    startColumn: diagnostic.column,
    endLineNumber: diagnostic.endLine,
    endColumn: diagnostic.endColumn,
    source: diagnostic.source
  };
}

function createDecorations(markers, model) {
  if (!markers || !Array.isArray(markers) || markers.length === 0) return [];
  
  return markers.map(marker => {
    if (!marker) return null;
    
    const isError = marker.severity === monaco.MarkerSeverity.Error;
    const classType = isError ? 'error' : 'warning';
    
    try {
      // –°–æ–∑–¥–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏—é –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞
      return {
        range: new monaco.Range(
          marker.startLineNumber || 1,
          marker.startColumn || 1,
          marker.endLineNumber || (marker.startLineNumber || 1),
          marker.endColumn || (marker.startColumn || 1) + 1
        ),
        options: {
          inlineClassName: `${classType}-text`,
          hoverMessage: { value: marker.message || (isError ? '–û—à–∏–±–∫–∞' : '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ') },
          stickiness: monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,
          zIndex: 1
        }
      };
    } catch (e) {
      console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏:', e);
      return null;
    }
  }).filter(Boolean);
}

function setupErrorDecorations(editor: monaco.editor.IStandaloneCodeEditor): void {
  try {
    if (!editor) {
      console.error('setupErrorDecorations: editor is null or undefined');
      return;
    }

    const model = editor.getModel();
    if (!model) {
      console.error('setupErrorDecorations: model is null or undefined');
      return;
    }

    // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–ø—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫
    editor.updateOptions({
      glyphMargin: true,  // –í–∫–ª—é—á–∞–µ–º –ø–æ–ª–µ –¥–ª—è –≥–ª–∏—Ñ–æ–≤
      lineHeight: 18,     // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä–æ–∫
      lineDecorationsWidth: 10,  // –£–º–µ–Ω—å—à–∞–µ–º —à–∏—Ä–∏–Ω—É –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ü–∏–π
      renderLineHighlight: 'none',  // –û—Ç–∫–ª—é—á–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ª–∏–Ω–∏–π
      folding: true,
      fixedOverflowWidgets: true,  // –£–ª—É—á—à–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –æ–∫–æ–Ω
      scrollBeyondLastLine: false  // –£–ª—É—á—à–∞–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ
    });

    // –ü–æ–ª—É—á–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –º–æ–¥–µ–ª–∏
    const markers = monaco.editor.getModelMarkers({ resource: model.uri });
    
    // –ï—Å–ª–∏ –Ω–µ—Ç –º–∞—Ä–∫–µ—Ä–æ–≤, –æ—á–∏—â–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
    if (!markers || markers.length === 0) {
      editor.deltaDecorations([], []);
      return;
    }

    // –°–æ–∑–¥–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–∏
    const decorations = createDecorations(markers, model);
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
    const oldDecorations = editor.getDecorationsInRange(
      new monaco.Range(1, 1, model.getLineCount(), model.getLineMaxColumn(model.getLineCount()))
    ) || [];
    
    const oldDecorationIds = oldDecorations
      .filter(d => d.options.className?.includes('error') || d.options.className?.includes('warning'))
      .map(d => d.id);
    
    editor.deltaDecorations(oldDecorationIds, decorations);
    
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
    setTimeout(() => {
      editor.layout();
      editor.render(true);
    }, 10);
  } catch (error) {
    console.error('Error in setupErrorDecorations:', error);
  }
}

/**
 * –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É Python –≤ Monaco Editor, –∏—Å–ø–æ–ª—å–∑—É—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∏–ª–∏ Pylance
 * @returns –£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
 */
export function registerPython(): boolean {
  try {
    console.log('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Python...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Monaco
    if (!window.monaco) {
      console.error('Monaco –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É Python.');
      return false;
    }
    
    const monaco = window.monaco;
    
    // –°–æ–∑–¥–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Python
    if (!window.pythonDiagnosticsStore) {
      console.log('–°–æ–∑–¥–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Python...');
      (window as any).pythonDiagnosticsStore = {
        markers: new Map(),
        setMarkers: function(uri: string, diagnostics: any[]) {
          this.markers.set(uri, diagnostics);
          console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${diagnostics.length} –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è ${uri}`);
          
          // –ù–∞—Ö–æ–¥–∏–º –º–æ–¥–µ–ª—å –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Ä–∫–µ—Ä—ã –Ω–∞–ø—Ä—è–º—É—é
          try {
            const models = window.monaco.editor.getModels();
            const model = models.find((m: any) => {
              const modelPath = m.uri.path;
              return modelPath === uri || 
                     modelPath.endsWith(uri) || 
                     m.uri.toString().includes(uri);
            });
            
            if (model) {
              // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç Monaco –º–∞—Ä–∫–µ—Ä–æ–≤
              const markers = diagnostics.map((diag: any) => ({
                severity: mapSeverityToMonaco(diag.severity || 'warning'),
                startLineNumber: diag.range.start.line + 1,
                startColumn: diag.range.start.character + 1,
                endLineNumber: diag.range.end.line + 1,
                endColumn: diag.range.end.character + 1,
                message: diag.message,
                source: 'Pylance'
              }));
              
              window.monaco.editor.setModelMarkers(model, 'python', markers);
              console.log(`‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã ${markers.length} –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –º–æ–¥–µ–ª–∏ ${model.uri.toString()}`);
            }
          } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä—è–º–æ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Ä–∫–µ—Ä–æ–≤:', err);
          }
          
          // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤
          try {
            const event = new CustomEvent('markers-updated', { 
              detail: { uri, count: diagnostics.length, diagnostics } 
            });
            document.dispatchEvent(event);
          } catch (err) {
            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤:', err);
          }
        },
        getMarkers: function(uri: string) {
          return this.markers.get(uri) || [];
        },
        getAllMarkersForUI: function() {
          const result: any[] = [];
          const processedUris = new Set<string>(); // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ URI
          
          this.markers.forEach((diagnostics: any[], uri: string) => {
            if (diagnostics && diagnostics.length > 0) {
              // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º URI, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
              let normalizedUri = uri;
              try {
                // –£–¥–∞–ª—è–µ–º URL-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ –ø—É—Ç–∏
                if (uri.includes('%')) {
                  normalizedUri = decodeURIComponent(uri);
                }
                
                // –û—á–∏—â–∞–µ–º –ø—É—Ç—å –æ—Ç —Å—Ö–µ–º—ã file://
                if (normalizedUri.startsWith('file://')) {
                  normalizedUri = normalizedUri.replace('file://', '');
                }
                
                // –ó–∞–º–µ–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω—ã–µ —Å–ª–µ—à–∏ –Ω–∞ –ø—Ä—è–º—ã–µ –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è
                normalizedUri = normalizedUri.replace(/\\/g, '/');
              } catch (e) {
                console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ URI:', e);
              }
              
              // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã URI
              if (processedUris.has(normalizedUri)) {
                return;
              }
              processedUris.add(normalizedUri);
              
              // –ü–æ–ª—É—á–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ URI
              let fileName = normalizedUri.split('/').pop() || '';
              
              // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –¥–ª—è —Ñ–∞–π–ª–∞
              result.push({
                filePath: normalizedUri,
                fileName: fileName,
                issues: diagnostics.map((diag: any) => {
                  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º—ã
                  let severity = diag.severity === 'error' ? 'error' : 
                                 diag.severity === 'warning' ? 'warning' : 'info';
                  
                  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ LSP –≤ —Ñ–æ—Ä–º–∞—Ç UI
                  let line = (diag.range?.start?.line !== undefined) ? diag.range.start.line + 1 : 1;
                  let column = (diag.range?.start?.character !== undefined) ? diag.range.start.character + 1 : 1;
                  let endLine = (diag.range?.end?.line !== undefined) ? diag.range.end.line + 1 : line;
                  let endColumn = (diag.range?.end?.character !== undefined) ? diag.range.end.character + 1 : column;
                  
                  return {
                    severity: severity,
                    message: diag.message || '–û—à–∏–±–∫–∞ –≤ Python –∫–æ–¥–µ',
                    line: line,
                    column: column,
                    endLine: endLine,
                    endColumn: endColumn,
                    source: diag.source || 'python-validator',
                    code: diag.code
                  };
                })
              });
            }
          });
          return result;
        }
      };
      
      // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∞—Ä–∫–µ—Ä–∞–º Python
      (window as any).getPythonDiagnostics = () => {
        if (window.pythonDiagnosticsStore && 
            typeof window.pythonDiagnosticsStore.getAllMarkersForUI === 'function') {
          return window.pythonDiagnosticsStore.getAllMarkersForUI();
        }
        return [];
      };
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ —É—Ä–æ–≤–Ω–µ–π —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏ –æ—à–∏–±–æ–∫
    function mapSeverity(severity: number): number {
      // –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ LSP –∏ Monaco —É—Ä–æ–≤–Ω–µ–π —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç–∏
      // LSP: 1 = Error, 2 = Warning, 3 = Information, 4 = Hint
      // Monaco: 8 = Error, 4 = Warning, 2 = Info, 1 = Hint
      switch(severity) {
        case 1: return monaco.MarkerSeverity.Error;
        case 2: return monaco.MarkerSeverity.Warning;
        case 3: return monaco.MarkerSeverity.Info;
        case 4: return monaco.MarkerSeverity.Hint;
        default: return monaco.MarkerSeverity.Warning;
      }
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Python –¥–ª—è –º–æ–¥–µ–ª–∏
    window.registerPythonForModel = (model: monaco.editor.ITextModel) => {
      try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–æ–¥–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∏–º–µ–µ—Ç URI
        if (!model || !model.uri) {
          console.warn('–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å Python –¥–ª—è –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏');
          return;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–∞–π–ª Python —Ñ–∞–π–ª–æ–º
        const uri = model.uri.toString();
        const isPythonFile = uri.endsWith('.py') || uri.endsWith('.pyi') || model.getLanguageId() === 'python';
        if (!isPythonFile) {
          return;
        }
        
        console.log(`–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Python-–ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–ª—è –º–æ–¥–µ–ª–∏: ${uri}`);
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—É—é Python-–ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –¥–ª—è —Ñ–∞–π–ª–∞
        setTimeout(() => {
          try {
            // –í—ã–ø–æ–ª–Ω—è–µ–º –±–∞–∑–æ–≤—É—é –ø—Ä–æ–≤–µ—Ä–∫—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Python –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã
            const content = model.getValue();
            if (!content) {
              console.log('–ü—Ä–æ–ø—É—Å–∫ –ø—É—Å—Ç–æ–≥–æ —Ñ–∞–π–ª–∞');
              return;
            }
            
            // –í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –æ—à–∏–±–æ–∫
            runExtendedErrorChecks(model);
            
            // –ü—ã—Ç–∞–µ–º—Å—è –æ–±–Ω–æ–≤–∏—Ç—å Python –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
            setTimeout(() => {
              try {
                if (window.updatePythonDiagnostics && typeof window.updatePythonDiagnostics === 'function') {
                  window.updatePythonDiagnostics(uri)
                    .catch(error => {
                      console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Python –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –¥–ª—è ${uri}:`, error);
                    });
                }
              } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ updatePythonDiagnostics:', error);
              }
            }, 500);  // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–π–º–∞—É—Ç –≤ 500 –º—Å –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
          } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –±–∞–∑–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ Python:', error);
          }
        }, 100);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Python –¥–ª—è –º–æ–¥–µ–ª–∏:', error);
      }
    };
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—à–∏–±–æ–∫
    function runExtendedErrorChecks(model: monaco.editor.ITextModel): void {
      if (!model) return;

      const content = model.getValue();
      const lines = content.split('\n');
      const diagnostics: IPythonDiagnostic[] = [];

      lines.forEach((line, index) => {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
        const divisionByZeroMatch = line.match(/\b(\w+\s*(?:\[\s*\w+\s*\])?\s*)?\/\s*(0|0\.0*)\b/);
        if (divisionByZeroMatch) {
          diagnostics.push({
            severity: 'error',
            message: '‚ö†Ô∏è –û—à–∏–±–∫–∞: –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å',
            line: index + 1,
            column: line.indexOf(divisionByZeroMatch[0]) + 1,
            endLine: index + 1,
            endColumn: line.indexOf(divisionByZeroMatch[0]) + divisionByZeroMatch[0].length + 1,
            source: 'Python Validator'
          });
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ —Å –¥–≤–æ–µ—Ç–æ—á–∏–µ–º
        if (line.match(/^\s*(if|for|while|def|class|with|try|except|finally)\s+[^:]*$/)) {
          diagnostics.push({
            severity: 'error',
            message: '‚ùå –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–≤–æ–µ—Ç–æ—á–∏–µ',
            line: index + 1,
            column: 1,
            endLine: index + 1,
            endColumn: line.length + 1,
            source: 'Python Validator'
          });
        }
      });

      // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –≤ –º–∞—Ä–∫–µ—Ä—ã Monaco
      const markers = diagnostics.map(createMarkerData);
      monaco.editor.setModelMarkers(model, 'python', markers);
    }
    
    // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —è–∑—ã–∫ Python, –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
    const languages = monaco.languages.getLanguages();
    const pythonRegistered = languages.some((lang: { id: string }) => lang.id === 'python');
    
    if (!pythonRegistered) {
      // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —è–∑—ã–∫ Python
      monaco.languages.register({
        id: 'python',
        extensions: ['.py', '.pyw', '.pyi'],
        aliases: ['Python', 'python'],
        mimetypes: ['text/x-python', 'text/python'],
      });
      console.log('Python —è–∑—ã–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ Monaco');
    }
    
    // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ Python –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    monaco.editor.onDidCreateModel((model: any) => {
      try {
        if (window.registerPythonForModel && typeof window.registerPythonForModel === 'function') {
          window.registerPythonForModel(model);
          
          // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
          if (model && model.getLanguageId() === 'python') {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
            let updateTimeout: any = null;
            model.onDidChangeContent(() => {
              if (updateTimeout) {
                clearTimeout(updateTimeout);
              }
              
              updateTimeout = setTimeout(() => {
                if (window.updatePythonDiagnostics && typeof window.updatePythonDiagnostics === 'function') {
                  window.updatePythonDiagnostics(model.uri.toString())
                    .catch(err => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Python –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:', err));
                }
              }, 500);
            });
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏
            setTimeout(() => {
              if (window.updatePythonDiagnostics && typeof window.updatePythonDiagnostics === 'function') {
                window.updatePythonDiagnostics(model.uri.toString())
                  .catch(err => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Python –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:', err));
              }
              
              // –í–∫–ª—é—á–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—è –≥–ª–∏—Ñ–æ–≤ –≤–æ –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞—Ö —Å —ç—Ç–æ–π –º–æ–¥–µ–ª—å—é
              try {
                const editors = monaco.editor.getEditors();
                editors.forEach((editor: any) => {
                  if (editor.getModel() === model) {
                    editor.updateOptions({ glyphMargin: true });
                    console.log('–í–∫–ª—é—á–µ–Ω–æ –ø–æ–ª–µ –≥–ª–∏—Ñ–æ–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ Python');
                  }
                });
              } catch (err) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –≤–∫–ª—é—á–∏—Ç—å –ø–æ–ª–µ –≥–ª–∏—Ñ–æ–≤:', err);
              }
            }, 100);
          }
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏ Python:', error);
      }
    });
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ Python —Ñ–∞–π–ª–æ–≤
    setTimeout(() => {
      try {
        const models = monaco.editor.getModels();
        console.log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ ${models.length} —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π –Ω–∞ Python —Ñ–∞–π–ª—ã...`);
        
        models.forEach((model: monaco.editor.ITextModel) => {
          if (window.registerPythonForModel && typeof window.registerPythonForModel === 'function') {
            window.registerPythonForModel(model);
          }
        });
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥–µ–ª–µ–π:', error);
      }
    }, 1000);
    
    // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å Pylance –¥–ª—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –æ–ø—ã—Ç–∞
    initializePylance().catch(err => {
      console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Pylance, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä:', err);
      
      // –ï—Å–ª–∏ Pylance –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
      setupBuiltinPythonSupport(monaco);
    });
    
    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º pip –ø–∞–∫–µ—Ç—ã –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è
    loadPipPackages().catch(err => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–µ pip –ø–∞–∫–µ—Ç–æ–≤:', err));

    // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π Python
    (window as any).updatePythonDiagnostics = async (filePath: string) => {
      try {
        console.log('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Python –¥–ª—è —Ñ–∞–π–ª–∞:', filePath);
        
        // –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∏–∑ Monaco, –µ—Å–ª–∏ –µ—Å—Ç—å –º–æ–¥–µ–ª—å
        let content = '';
        let model = null;
        
        if (monaco && monaco.editor) {
          try {
            const models = monaco.editor.getModels();
            model = models.find((m: any) => {
              const modelPath = m.uri.path;
              return modelPath === filePath || 
                     modelPath.endsWith(filePath) || 
                     m.uri.toString().includes(filePath);
            });
            
            if (model) {
              content = model.getValue();
              console.log(`–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è ${filePath} –∏–∑ Monaco –º–æ–¥–µ–ª–∏`);
            }
          } catch (err) {
            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–∑ –º–æ–¥–µ–ª–∏ Monaco:', err);
          }
        }
        
        // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∏–∑ Monaco, –ø—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ Tauri
        if (!content) {
          try {
            content = await invoke('read_file', { path: filePath }) as string;
            console.log(`–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–ª—è ${filePath} —á–µ—Ä–µ–∑ Tauri API`);
          } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ Tauri:', err);
            return `error: –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª ${filePath}`;
          }
        }
        
        if (!content) {
          return `error: –ü—É—Å—Ç–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ ${filePath}`;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É –Ω–∞—Å –¥–æ—Å—Ç—É–ø –∫ Pylance API
        if (window.pylance && typeof window.pylance.provideDiagnostics === 'function') {
          try {
            console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Pylance API –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏');
            const pylance = window.pylance;
            const diagnostics = await pylance.provideDiagnostics(filePath, content);
            
            if (diagnostics && Array.isArray(diagnostics)) {
              console.log(`–ü–æ–ª—É—á–µ–Ω–æ ${diagnostics.length} –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç Pylance`);
              
              // –£–±–µ–¥–∏–º—Å—è —á—Ç–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –¥–ª—è Python —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
              if (!window.pythonDiagnosticsStore) {
                console.log('‚ö° –°–æ–∑–¥–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Python –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫');
                (window as any).pythonDiagnosticsStore = {
                  markers: new Map(),
                  setMarkers: function(uri: string, diagnostics: any[]) {
                    this.markers.set(uri, diagnostics);
                    console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${diagnostics.length} –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è ${uri}`);
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤
                    try {
                      const event = new CustomEvent('markers-updated', { 
                        detail: { uri, count: diagnostics.length, diagnostics } 
                      });
                      document.dispatchEvent(event);
                    } catch (err) {
                      console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤:', err);
                    }
                  },
                  getMarkers: function(uri: string) {
                    return this.markers.get(uri) || [];
                  }
                };
              }
              
              // –û–±–Ω–æ–≤–ª—è–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –º–∞—Ä–∫–µ—Ä–æ–≤
              window.pythonDiagnosticsStore.setMarkers(filePath, diagnostics);
              
              // –ï—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å –º–æ–¥–µ–ª—å, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã –Ω–∞–ø—Ä—è–º—É—é
              if (model) {
                const markers = diagnostics.map((diag: any) => ({
                  severity: mapSeverity(diag.severity || 1),
                  startLineNumber: diag.range.start.line + 1,
                  startColumn: diag.range.start.character + 1,
                  endLineNumber: diag.range.end.line + 1,
                  endColumn: diag.range.end.character + 1,
                  message: diag.message,
                  source: 'Pylance'
                }));
                
                monaco.editor.setModelMarkers(model, 'python', markers);
                console.log(`–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ ${markers.length} –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è –º–æ–¥–µ–ª–∏`);
              }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
            setTimeout(() => {
              if (window.monaco && window.setupErrorDecorations && typeof window.setupErrorDecorations === 'function') {
                const editors = window.monaco.editor.getEditors();
                if (editors && editors.length > 0) {
                  console.log(`üé® –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–π –¥–ª—è ${editors.length} —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ –ø–æ—Å–ª–µ Python –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏`);
                  editors.forEach((editor: any) => {
                    try {
                      if (window.setupErrorDecorations) {
                        window.setupErrorDecorations(editor);
                      }
                    } catch (err) {
                      console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–π:', err);
                    }
                  });
                }
              }
              
              // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–±–ª–µ–º
              try {
                const problemsEvent = new CustomEvent('python-diagnostics-updated', { 
                  detail: { diagnostics: window.pythonDiagnosticsStore?.getAllMarkersForUI() || [] } 
                });
                document.dispatchEvent(problemsEvent);
              } catch (err) {
                console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–±–ª–µ–º:', err);
              }
            }, 100);
            
            return 'success';
          } catch (pylanceError) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Pylance API:', pylanceError);
            // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å LSP-—Å–µ—Ä–≤–µ—Ä–æ–º –∫–∞–∫ –∑–∞–ø–∞—Å–Ω—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º
          }
        }
        
        // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ mockPythonDiagnostics
        const { languageServerManager } = await import('../main-screen/centerContainer/monaco-lsp-server-manager');
        
        // –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        if (languageServerManager) {
          languageServerManager.sendNotification('python', 'textDocument/didOpen', {
            textDocument: {
              uri: filePath,
              languageId: 'python',
              version: 1,
              text: content
            }
          });
          
          // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É
          languageServerManager.sendNotification('python', 'textDocument/didChange', {
            textDocument: {
              uri: filePath,
              version: 2
            },
            contentChanges: [{ text: content }]
          });
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
          setTimeout(() => {
            if (window.monaco && window.setupErrorDecorations && typeof window.setupErrorDecorations === 'function') {
              const editors = window.monaco.editor.getEditors();
              if (editors && editors.length > 0) {
                console.log(`üé® –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–π –¥–ª—è ${editors.length} —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ –ø–æ—Å–ª–µ Python –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏`);
                editors.forEach((editor: any) => {
                  try {
                    if (window.setupErrorDecorations) {
                      window.setupErrorDecorations(editor);
                    }
                  } catch (err) {
                    console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–π:', err);
                  }
                });
              }
            }
          }, 100); // –£–º–µ–Ω—å—à–∞–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
          
          return 'success';
        } else {
          console.error('–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
          return 'error: –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω';
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ Python:', error);
        return `error: ${error}`;
      }
    };
    
    // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º –±–µ–∑ LSP —Å–µ—Ä–≤–µ—Ä–∞
    setTimeout(async () => {
      try {
        // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
        window.addEventListener('beforeunload', () => {
          console.log('–û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ Python –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...');
          clearAllPythonDiagnostics();
        });
        
        // –°–æ–∑–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö Python –º–æ–¥–µ–ª–µ–π
        (window as any).updateAllPythonModels = () => {
          try {
            const models = monaco.editor.getModels();
            let pythonModelsCount = 0;
            
            models.forEach((model: monaco.editor.ITextModel) => {
              if (model.getLanguageId() === 'python') {
                pythonModelsCount++;
                
                if (window.registerPythonForModel && typeof window.registerPythonForModel === 'function') {
                  window.registerPythonForModel(model);
                  
                  // –í–∫–ª—é—á–∞–µ–º glyphMargin –≤–æ –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞—Ö —Å Python
                  const editors = monaco.editor.getEditors().filter((editor: any) => 
                    editor.getModel() && editor.getModel().uri.toString() === model.uri.toString()
                  );
                  
                  editors.forEach((editor: any) => {
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–ø—Ü–∏–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–ª–∏—Ñ–æ–≤
                    editor.updateOptions({ 
                      glyphMargin: true,
                      lineNumbers: 'on',
                      folding: true,
                      minimap: { enabled: true }
                    });
                    
                    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
                    setTimeout(() => {
                      try {
                        // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –º–æ–¥–µ–ª–∏
                        const markers = monaco.editor.getModelMarkers({ resource: model.uri });
                        
                        // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –º–∞—Ä–∫–µ—Ä—ã, —Å–æ–∑–¥–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
                        if (markers && markers.length > 0) {
                          console.log(`–ü—Ä–∏–º–µ–Ω—è–µ–º ${markers.length} –¥–µ–∫–æ—Ä–∞—Ü–∏–π –Ω–∞–ø—Ä—è–º—É—é`);
                        
                          // –°–æ–∑–¥–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ—à–∏–±–æ–∫ (–∏—Å–ø–æ–ª—å–∑—É—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã)
                          const decorations = Array.from(new Set(markers.map(m => JSON.stringify(m)))).map(key => {
                            const marker = JSON.parse(key);
                            const isError = marker.severity === monaco.MarkerSeverity.Error;
                            
                            return [
                              // –î–µ–∫–æ—Ä–∞—Ü–∏—è –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–æ–∫–∏ (—Ñ–æ–Ω)
                              {
                                range: new monaco.Range(
                                  marker.startLineNumber, 
                                  1,
                                  marker.startLineNumber,
                                  model.getLineMaxColumn(marker.startLineNumber)
                                ),
                                options: {
                                  isWholeLine: true,
                                  className: isError ? 'error-line' : 'warning-line',
                                  glyphMarginClassName: isError ? 'error-glyph' : 'warning-glyph',
                                  overviewRuler: {
                                    color: isError ? '#F14C4C' : '#CCA700',
                                    position: monaco.editor.OverviewRulerLane.Right
                                  },
                                  minimap: {
                                    color: isError ? '#F14C4C' : '#CCA700',
                                    position: monaco.editor.MinimapPosition.Inline
                                  },
                                  hoverMessage: { value: marker.message }
                                }
                              },
                              // –î–µ–∫–æ—Ä–∞—Ü–∏—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –æ—à–∏–±–∫–∏ (–ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ)
                              {
                                range: new monaco.Range(
                                  marker.startLineNumber,
                                  marker.startColumn,
                                  marker.endLineNumber,
                                  marker.endColumn
                                ),
                                options: {
                                  className: isError ? 'error-text' : 'warning-text',
                                  hoverMessage: { value: marker.message },
                                  stickiness: monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges
                                }
                              }
                            ];
                          }).flat();
                          
                          // –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
                          const oldDecorations: string[] = [];
                          editor.deltaDecorations(oldDecorations, decorations);
                        }
                        
                        editor.layout();
                        editor.render(true);
                        console.log('‚úÖ –†–µ–¥–∞–∫—Ç–æ—Ä Python –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª–µ–Ω —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ –≥–ª–∏—Ñ–∞–º–∏');
                      } catch (e) {
                        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä:', e);
                      }
                    }, 100);
                  });
                }
              }
            });
            
            console.log(`–û–±–Ω–æ–≤–ª–µ–Ω–æ ${pythonModelsCount} Python –º–æ–¥–µ–ª–µ–π`);
            return pythonModelsCount;
          } catch (err) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Python –º–æ–¥–µ–ª–µ–π:', err);
            return 0;
          }
        };
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(() => {
          if ((window as any).updateAllPythonModels) {
            (window as any).updateAllPythonModels();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            setTimeout(() => {
              if ((window as any).updateAllPythonModels) {
                (window as any).updateAllPythonModels();
              }
            }, 3000);
          }
        }, 1000);
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ Python –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:', error);
      }
    }, 1000);
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ–∫–æ—Ä–∞—Ü–∏–π –≤ —Ç–µ–∫—É—â–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
    function setupErrorDecorations(editor: monaco.editor.IStandaloneCodeEditor): void {
      try {
        if (!editor) {
          console.error('setupErrorDecorations: editor is null or undefined');
          return;
        }

        const model = editor.getModel();
        if (!model) {
          console.error('setupErrorDecorations: model is null or undefined');
          return;
        }

        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–ø—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫
        editor.updateOptions({
          glyphMargin: true,  // –í–∫–ª—é—á–∞–µ–º –ø–æ–ª–µ –¥–ª—è –≥–ª–∏—Ñ–æ–≤
          lineHeight: 18,     // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä–æ–∫
          lineDecorationsWidth: 10,  // –£–º–µ–Ω—å—à–∞–µ–º —à–∏—Ä–∏–Ω—É –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ü–∏–π
          renderLineHighlight: 'none',  // –û—Ç–∫–ª—é—á–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ª–∏–Ω–∏–π
          folding: true,
          fixedOverflowWidgets: true,  // –£–ª—É—á—à–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –æ–∫–æ–Ω
          scrollBeyondLastLine: false  // –£–ª—É—á—à–∞–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ
        });

        // –ü–æ–ª—É—á–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –º–æ–¥–µ–ª–∏
        const markers = monaco.editor.getModelMarkers({ resource: model.uri });
        
        // –ï—Å–ª–∏ –Ω–µ—Ç –º–∞—Ä–∫–µ—Ä–æ–≤, –æ—á–∏—â–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
        if (!markers || markers.length === 0) {
          editor.deltaDecorations([], []);
          return;
        }

        // –°–æ–∑–¥–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–∏
        const decorations = createDecorations(markers, model);
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
        const oldDecorations = editor.getDecorationsInRange(
          new monaco.Range(1, 1, model.getLineCount(), model.getLineMaxColumn(model.getLineCount()))
        ) || [];
        
        const oldDecorationIds = oldDecorations
          .filter(d => d.options.className?.includes('error') || d.options.className?.includes('warning'))
          .map(d => d.id);
        
        editor.deltaDecorations(oldDecorationIds, decorations);
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
        setTimeout(() => {
          editor.layout();
          editor.render(true);
        }, 10);
  } catch (error) {
        console.error('Error in setupErrorDecorations:', error);
      }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    if (window) {
      window.setupErrorDecorations = setupErrorDecorations;
      window.setupAllErrorDecorations = () => {
        const editors = monaco.editor.getEditors();
        editors.forEach((editor: any) => {
          if (window.setupErrorDecorations) {
            window.setupErrorDecorations(editor);
          }
        });
      };
      window.globalMarkersStore = new Map<string, IPythonMarker[]>();
    }

    // –£–¥–∞–ª–∏–º —Å—Ç–∞—Ä—ã–µ —Å—Ç–∏–ª–∏ –∏ –¥–æ–±–∞–≤–∏–º –Ω–æ–≤—ã–µ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ
    // –°–æ–∑–¥–∞–¥–∏–º –Ω–∞—à —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å
    const simpleErrorStyleId = 'monaco-simple-error-styles';
    if (!document.getElementById(simpleErrorStyleId)) {
      const style = document.createElement('style');
      style.id = simpleErrorStyleId;
      style.innerHTML = `
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ç–µ–∫—Å—Ç */
        .monaco-editor .error-decoration,
        .monaco-editor .error-text {
          text-decoration: wavy underline #f44336 !important;
          text-decoration-skip-ink: none !important;
          background-color: transparent !important;
          display: inline !important;
          position: relative !important;
          z-index: 1 !important;
          pointer-events: auto !important;
        }
        
        .monaco-editor .warning-decoration,
        .monaco-editor .warning-text {
          text-decoration: wavy underline #ff9800 !important;
          text-decoration-skip-ink: none !important;
          background-color: transparent !important;
          display: inline !important;
          position: relative !important;
          z-index: 1 !important;
          pointer-events: auto !important;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≥—Ä–∞–Ω–∏—Ü—ã –æ—à–∏–±–æ–∫, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ —Ç–µ–∫—Å—Ç–∞ */
        .monaco-editor .view-overlays .cdr {
          border: none !important;
          background: transparent !important;
          width: auto !important;
          height: auto !important;
          position: static !important;
        }
        
        /* –°—Ç–∏–ª–∏ –≥–ª–∏—Ñ–æ–≤ - –¥–µ–ª–∞–µ–º –∏—Ö —Ç–æ–Ω–∫–∏–º–∏ –∏ –Ω–∞ –ø–æ–ª—è—Ö */
        .monaco-editor .error-glyph,
        .monaco-editor .warning-glyph {
          margin-left: 0 !important;
          width: 3px !important;
          height: 18px !important;
          display: inline-block !important;
          position: absolute !important;
          left: 0 !important;
          top: 0 !important;
          background-color: transparent !important;
          pointer-events: none !important;
        }
        
        .monaco-editor .error-glyph::after {
          content: "";
          display: block;
          width: 3px;
          height: 18px;
          background: #F14C4C;
          border-radius: 1px;
        }
        
        .monaco-editor .warning-glyph::after {
          content: "";
          display: block;
          width: 3px;
          height: 18px;
          background: #CCA700;
          border-radius: 1px;
        }
        
        /* –§–∏–∫—Å–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ª–∏–Ω–∏–π */
        .monaco-editor .view-line {
          position: relative !important;
          z-index: 0 !important;
          height: 18px !important;
          line-height: 18px !important;
        }
      `;
      document.head.appendChild(style);
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫ –¥–ª—è –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
    window.forceUpdateAllDecorations = function forceUpdateAllDecorations(): number {
      try {
        let count = 0;
        const editors = monaco.editor.getEditors();
        
        editors.forEach(editor => {
          if (editor && editor.getModel()) {
            if (window.setupErrorDecorations) {
              window.setupErrorDecorations(editor);
              count++;
            }
          }
        });
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞–Ω–µ–ª–∏ –ø—Ä–æ–±–ª–µ–º
        window.dispatchEvent(new CustomEvent('markers-updated'));
        window.dispatchEvent(new CustomEvent('python-diagnostics-updated'));
        
        return count;
      } catch (error) {
        console.error('Error in forceUpdateAllDecorations:', error);
        return 0;
      }
    };

    // –î–æ–±–∞–≤–∏–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–µ–∫–æ—Ä–∞—Ü–∏–π
    // —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
    setInterval(() => {
      if (window.forceUpdateAllDecorations) {
        window.forceUpdateAllDecorations();
      }
    }, 5000);

    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ç–∏–ø–∞ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
    const underlineOnlyStyleId = 'monaco-underline-only-styles';
    if (!document.getElementById(underlineOnlyStyleId)) {
      const style = document.createElement('style');
      style.id = underlineOnlyStyleId;
      style.innerHTML = `
        /* –¢–æ–ª—å–∫–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –±–µ–∑ —Ñ–æ–Ω–∞ –¥–ª—è –æ—à–∏–±–æ–∫ */
        .monaco-editor .error-underline-only {
          border-bottom: 2px wavy #f44336 !important;
          background-color: transparent !important;
          white-space: pre !important;
          display: inline !important;
          overflow: visible !important;
        }
        
        /* –¢–æ–ª—å–∫–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –±–µ–∑ —Ñ–æ–Ω–∞ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π */
        .monaco-editor .warning-underline-only {
          border-bottom: 2px wavy #ff9800 !important;
          background-color: transparent !important;
          white-space: pre !important;
          display: inline !important;
          overflow: visible !important;
        }
        
        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ */
        .monaco-editor .view-line {
          white-space: pre !important;
          overflow: visible !important;
        }
        
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ */
        .monaco-editor,
        .monaco-editor-background,
        .monaco-editor .inputarea,
        .monaco-editor .view-overlays,
        .monaco-editor .view-lines,
        .monaco-editor .view-line span {
          white-space: pre !important;
          word-wrap: normal !important;
        }
      `;
      document.head.appendChild(style);
    }

    /**
     * –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –¥–ª—è –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
     */
    function applyUnifiedErrorStyles() {
      try {
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π
        if (document.getElementById('monaco-unified-error-styles')) {
          return; // –°—Ç–∏–ª–∏ —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã
        }
        
        // –°–æ–∑–¥–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç —Å—Ç–∏–ª—è
        const style = document.createElement('style');
        style.id = 'monaco-unified-error-styles';
        style.innerHTML = `
          /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏ */
          .monaco-editor .error-line,
          .monaco-editor .warning-line {
            display: inline-block !important;
            white-space: nowrap !important;
            overflow: visible !important;
            height: 18px !important;
            min-height: 18px !important;
            max-height: 18px !important;
            line-height: 18px !important;
            margin: 0 !important;
            padding: 0 !important;
            box-sizing: border-box !important;
          }
          
          .monaco-editor .error-line {
            background-color: rgba(255, 0, 0, 0.03) !important;
          }
          
          .monaco-editor .warning-line {
            background-color: rgba(255, 165, 0, 0.03) !important;
          }
          
          .monaco-editor .error-text,
          .monaco-editor .warning-text {
            white-space: nowrap !important;
            display: inline !important;
            height: 18px !important;
            min-height: 18px !important;
            max-height: 18px !important;
            line-height: 18px !important;
            margin: 0 !important;
            padding: 0 !important;
            box-sizing: border-box !important;
            text-overflow: ellipsis !important;
            overflow: hidden !important;
          }
          
          .monaco-editor .error-text {
            border-bottom: 1px wavy #F14C4C !important;
          }
          
          .monaco-editor .warning-text {
            border-bottom: 1px wavy #CCA700 !important;
          }
          
          /* –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≥–ª–∏—Ñ—ã –¥–ª—è –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π */
          .monaco-editor .error-glyph,
          .monaco-editor .warning-glyph {
            margin-left: 2px !important;
            width: 3px !important;
            height: 12px !important;
            border-radius: 1px !important;
          }
          
          .monaco-editor .error-glyph {
            background: #F14C4C !important;
          }
          
          .monaco-editor .warning-glyph {
            background: #CCA700 !important;
          }
          
          /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω—ã—Ö –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫ */
          .monaco-hover-content {
            font-size: 11px !important;
            line-height: 1.2 !important;
            max-width: 600px !important;
            padding: 3px 6px !important;
          }
          
          /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ */
          .monaco-editor .view-line {
            display: inline-block !important;
            white-space: nowrap !important;
            overflow: visible !important;
          }
          
          /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –ª–∏–Ω–∏–π –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ */
          .monaco-editor .view-lines {
            white-space: nowrap !important;
            overflow: visible !important;
          }
          
          /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã –ª–∏–Ω–∏–π —Å –æ—à–∏–±–∫–∞–º–∏ */
          .monaco-editor .view-overlays .current-line,
          .monaco-editor .margin-view-overlays .current-line-margin {
            height: 18px !important;
            min-height: 18px !important;
            max-height: 18px !important;
          }
        `;
        document.head.appendChild(style);
        console.log('‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω—ã —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π');
        
        // –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è
        if (window.forceUpdateAllDecorations && typeof window.forceUpdateAllDecorations === 'function') {
          setTimeout(() => {
            window.forceUpdateAllDecorations();
          }, 500);
        }
  } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∏–ª–µ–π:', error);
      }
    }

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (typeof document !== 'undefined') {
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        applyUnifiedErrorStyles();
      } else {
        document.addEventListener('DOMContentLoaded', applyUnifiedErrorStyles);
      }
    }

    // –¢–∞–∫–∂–µ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Python –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    setTimeout(applyUnifiedErrorStyles, 2000);

    /**
     * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –¥–ª—è –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
     * –£–¥–∞–ª—è–µ—Ç –ª–∏—à–Ω—é—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –¥–µ–ª–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º
     */
    function formatCompactErrorMessage(message: string, filename: string, isError: boolean): string {
      if (!message) return '';
      
      // –û—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ª–∏—à–Ω–∏—Ö –¥–µ—Ç–∞–ª–µ–π
      let cleanMessage = message
        .replace(/Python \[\d+(\.\d+)*\]/g, '')
        .replace(/\(pycodestyle\)/g, '')
        .replace(/\(pylint\)/g, '')
        .replace(/\(mypy\)/g, '')
        .replace(/\(pyflakes\)/g, '')
        .replace(/(^\s+|\s+$)/g, ''); // –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–æ–π
      const isSyntaxError = 
        message.includes('SyntaxError') || 
        message.includes('—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞') ||
        message.includes('–Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å') ||
        message.includes('invalid syntax') ||
        message.includes('expected') ||
        message.includes('–æ–∂–∏–¥–∞–ª–æ—Å—å');
      
      // –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫
      const icon = isError 
        ? (isSyntaxError ? '‚ö†Ô∏è ' : '‚ùå ')
        : '‚ö†Ô∏è ';
      
      // –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ, –æ–±—Ä–µ–∑–∞–µ–º –µ–≥–æ
      const maxLength = 80;
      if (cleanMessage.length > maxLength) {
        cleanMessage = cleanMessage.substring(0, maxLength - 3) + '...';
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –∏ —Ç–∏–ø –æ—à–∏–±–∫–∏
      const prefix = isError ? '–û—à–∏–±–∫–∞' : '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ';
      
      // –ï—Å–ª–∏ –∏–º—è —Ñ–∞–π–ª–∞ –¥–æ—Å—Ç—É–ø–Ω–æ, –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ
      if (filename) {
        return `${icon}${prefix} –≤ ${filename}: ${cleanMessage}`;
      }
      
      return `${icon}${prefix}: ${cleanMessage}`;
    }

    // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
    (window as any).updateEditorStyles = function() {
      try {
        console.log('üé® –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞...');
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏
        applyUnifiedErrorStyles();
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤–ø—Ä—ã—Å–∫–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ DOM
        const styleId = 'monaco-no-line-wrap-force';
        if (!document.getElementById(styleId)) {
          const styleElement = document.createElement('style');
          styleElement.id = styleId;
          styleElement.innerHTML = `
            /* –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫ */
            .monaco-editor .view-line, 
            .monaco-editor .view-lines,
            .monaco-editor .view-line span,
            .monaco-editor .mtk1,
            .monaco-editor .mtk2,
            .monaco-editor .mtk3,
            .monaco-editor .mtk4,
            .monaco-editor .mtk5,
            .monaco-editor .mtk6,
            .monaco-editor .mtk7,
            .monaco-editor .mtk8,
            .monaco-editor .mtk9 {
              white-space: pre !important;
              display: inline-block !important;
              width: auto !important;
              overflow: visible !important;
            }
            
            /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ */
            .monaco-editor .view-line {
              height: 18px !important;
              min-height: 18px !important;
              max-height: 18px !important;
              line-height: 18px !important;
            }
            
            /* –£–±–∏—Ä–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å –¥–ª—è –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π */
            .error-text, .warning-text,
            .monaco-editor .error-text, 
            .monaco-editor .warning-text,
            .monaco-editor .error-line, 
            .monaco-editor .warning-line {
              white-space: pre !important;
              display: inline-block !important;
              overflow: visible !important;
              height: 18px !important;
              line-height: 18px !important;
            }
          `;
          document.head.appendChild(styleElement);
          console.log('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∞ —Ç–µ–∫—Å—Ç–∞');
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã
        const editors = window.monaco?.editor.getEditors() || [];
        console.log(`üìù –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ${editors.length} —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤`);
        
        // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é
        setTimeout(() => {
          try {
            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å—Ç—Ä–æ–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
            const viewLines = document.querySelectorAll('.monaco-editor .view-lines');
            viewLines.forEach(lines => {
              // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å—Ç—Ä–æ–∫
              const el = lines as HTMLElement;
              el.style.whiteSpace = 'pre';
              el.style.overflowX = 'auto';
              el.style.overflowY = 'hidden';
              
              // –ù–∞—Ö–æ–¥–∏–º –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –≤–Ω—É—Ç—Ä–∏
              const viewLineElements = el.querySelectorAll('.view-line');
              viewLineElements.forEach(line => {
                const lineEl = line as HTMLElement;
                lineEl.style.whiteSpace = 'pre';
                lineEl.style.display = 'inline-block';
                lineEl.style.height = '18px';
                lineEl.style.minHeight = '18px';
                lineEl.style.maxHeight = '18px';
                lineEl.style.lineHeight = '18px';
                lineEl.style.overflowX = 'visible';
                lineEl.style.overflowY = 'hidden';
                
                // –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã span –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏
                const spans = lineEl.querySelectorAll('span');
                spans.forEach(span => {
                  const spanEl = span as HTMLElement;
                  spanEl.style.whiteSpace = 'pre';
                  spanEl.style.display = 'inline-block';
                  spanEl.style.overflow = 'visible';
                });
              });
            });
            
            console.log('‚úÖ –°—Ç–∏–ª–∏ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
          } catch (domErr) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä—è–º–æ–π –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ DOM:', domErr);
          }
        }, 300);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
        editors.forEach(editor => {
          if (!editor || !editor.getModel) return;
          
          // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫
          editor.updateOptions({
            wordWrap: 'off',
            lineHeight: 18,
            fontLigatures: false,
            glyphMargin: true,
            lineDecorationsWidth: 12,
            wrappingStrategy: 'advanced',
            scrollBeyondLastLine: false,
            renderWhitespace: 'none'
          });
          
          // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
          setTimeout(() => {
            try {
              // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º –≤—Å–µ –º–µ—Ç–æ–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
              editor.layout();
              editor.render(true);
              editor.focus();
              
              // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM
              const domNode = editor.getDomNode();
              if (domNode) {
                // –î–æ–±–∞–≤–ª—è–µ–º –∞—Ç—Ä–∏–±—É—Ç –¥–ª—è CSS —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
                domNode.setAttribute('data-nowrap', 'true');
              }
            } catch (err) {
              console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:', err);
            }
          }, 100);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫
          if (window.setupErrorDecorations && typeof window.setupErrorDecorations === 'function') {
            window.setupErrorDecorations(editor);
          }
        });
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
        if (window.forceUpdateAllDecorations && typeof window.forceUpdateAllDecorations === 'function') {
          window.forceUpdateAllDecorations();
        }
        
        return editors.length;
        } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∏–ª–µ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:', error);
        return 0;
      }
    };
    
    // –í—ã–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π —á–µ—Ä–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    setTimeout(() => {
      if ((window as any).updateEditorStyles) {
        (window as any).updateEditorStyles();
      }
    }, 2000);

    // –î–æ–±–∞–≤–∏–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
    const fixErrorDisplayStyles = () => {
      const styleId = 'monaco-error-fix-display';
      if (!document.getElementById(styleId)) {
        const style = document.createElement('style');
        style.id = styleId;
        style.innerHTML = `
          /* –§–∏–∫—Å–∏—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞, —á—Ç–æ–±—ã –æ—à–∏–±–∫–∏ –Ω–µ –Ω–∞–ª–µ–∑–∞–ª–∏ –∏ –Ω–µ —Å–º–µ—â–∞–ª–∏ –ø–æ–∑–∏—Ü–∏—é */
          .monaco-editor .view-line,
          .monaco-editor .view-lines,
          .monaco-editor .view-line span {
            white-space: pre !important;
            display: inline !important;
          }
          
          /* –õ–∏–Ω–∏–∏ —Å –æ—à–∏–±–∫–∞–º–∏ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ */
          .monaco-editor .view-overlays .cslr,
          .monaco-editor .view-overlays .cdr {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            position: static !important;
            width: auto !important;
            height: auto !important;
            top: auto !important;
            left: auto !important;
          }
          
          /* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∏–∑–º–µ–Ω—è—Ç—å —Ä–∞–∑–º–µ—Ä—ã */
          .monaco-editor .decorationsOverviewRuler,
          .monaco-editor .decorationsOverviewRuler .decoration {
            position: absolute !important;
            right: 0 !important;
            z-index: 0 !important;
            pointer-events: none !important;
          }
          
          /* –£–ª—É—á—à–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –æ—à–∏–±–∫–∞–º–∏ */
          .monaco-editor .error-text,
          .monaco-editor .warning-text,
          .monaco-editor .error-decoration,
          .monaco-editor .warning-decoration {
            display: inline !important;
            position: relative !important;
            text-decoration: wavy underline !important;
            text-decoration-skip-ink: none !important;
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 !important;
            height: auto !important;
            width: auto !important;
            color: inherit !important;
          }
          
          .monaco-editor .error-text,
          .monaco-editor .error-decoration {
            text-decoration-color: #F14C4C !important;
          }
          
          .monaco-editor .warning-text,
          .monaco-editor .warning-decoration {
            text-decoration-color: #CCA700 !important;
          }
          
          /* –°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –º–∞—Ä–∫–µ—Ä–æ–≤ */
          .monaco-editor .margin-view-overlays .cgmr {
            width: 5px !important;
            height: 18px !important;
            margin: 0 !important;
            padding: 0 !important;
          }
        `;
        document.head.appendChild(style);
      }
    };

    // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫
    setTimeout(fixErrorDisplayStyles, 1000);

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π
    if (typeof window !== 'undefined') {
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        fixErrorDisplayStyles();
      } else {
        window.addEventListener('DOMContentLoaded', fixErrorDisplayStyles);
      }
      window.addEventListener('load', fixErrorDisplayStyles);
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ Python, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Ö –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ
    window.addEventListener('python-diagnostics-updated', () => {
      setTimeout(fixErrorDisplayStyles, 100);
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –∫–æ –≤—Å–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º
      if (window.monaco && window.monaco.editor) {
        const editors = window.monaco.editor.getEditors();
        editors.forEach(editor => {
          if (window.applyNoLineWrap) {
            window.applyNoLineWrap(editor);
          }
        });
      }
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ CSS —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫ —Å –æ—à–∏–±–∫–∞–º–∏
    const noLineWrapErrorStyleId = 'monaco-no-line-wrap-error-styles';
    if (!document.getElementById(noLineWrapErrorStyleId)) {
      const style = document.createElement('style');
      style.id = noLineWrapErrorStyleId;
      style.innerHTML = `
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –±–ª–æ–∫–∏—Ä—É–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ —Å –æ—à–∏–±–∫–∞–º–∏ */
        .monaco-editor .view-line,
        .monaco-editor .view-lines {
          white-space: pre !important;
          overflow-x: visible !important;
          overflow-y: hidden !important;
          word-wrap: normal !important;
          word-break: normal !important;
          text-overflow: clip !important;
          height: 18px !important;
          line-height: 18px !important;
          user-select: text !important;
          position: relative !important;
          width: auto !important;
          min-width: auto !important;
          max-width: none !important;
        }
        
        /* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç—Ä–æ–≥–∏–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ */
        .monaco-editor .mtk1,
        .monaco-editor .mtk2,
        .monaco-editor .mtk3,
        .monaco-editor .mtk4,
        .monaco-editor .mtk5,
        .monaco-editor .mtk6,
        .monaco-editor .mtk7,
        .monaco-editor .mtk8,
        .monaco-editor .mtk9,
        .monaco-editor span {
          display: inline !important;
          white-space: pre !important;
          overflow: visible !important;
          text-overflow: clip !important;
          height: 18px !important;
          line-height: 18px !important;
          position: static !important;
        }
        
        /* –°—Ç–∏–ª—å –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –æ—à–∏–±–æ–∫ */
        .monaco-editor .error-text,
        .monaco-editor .warning-text {
          text-decoration: wavy underline !important;
          text-decoration-skip-ink: none !important;
          border-bottom: none !important;
          background: transparent !important;
          height: 18px !important;
          line-height: 18px !important;
          position: relative !important;
          display: inline !important;
          white-space: pre !important;
          overflow: visible !important;
          text-overflow: clip !important;
          padding: 0 !important;
          margin: 0 !important;
        }
        
        .monaco-editor .error-text {
          text-decoration-color: #FF4C4C !important;
        }
        
        .monaco-editor .warning-text {
          text-decoration-color: #FFCC00 !important;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –ª–µ–≤–æ–º –ø–æ–ª–µ */
        .monaco-editor .margin-view-overlays .cgmr {
          height: 18px !important;
          line-height: 18px !important;
          width: 4px !important;
          position: absolute !important;
          left: 1px !important;
        }
        
        /* –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ */
        .monaco-editor .overflow-guard,
        .monaco-editor .monaco-scrollable-element {
          overflow-x: auto !important;
          overflow-y: auto !important;
        }
        
        .monaco-editor .view-overlays .cdr,
        .monaco-editor .view-overlays .cslr {
          border: none !important;
          background: transparent !important;
          position: static !important;
          width: auto !important;
          height: 18px !important;
          top: auto !important;
          left: auto !important;
        }
      `;
      document.head.appendChild(style);
    }

    /**
     * –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—â–∏—Ö –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ —Å –æ—à–∏–±–∫–∞–º–∏
     */
    window.applyNoLineWrap = function applyNoLineWrap(editor) {
      try {
        if (!editor) return;
        
        // –û—Ç–∫–ª—é—á–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–æ–∫
        editor.updateOptions({
          wordWrap: 'off',
          lineHeight: 18,
          lineDecorationsWidth: 12,
          glyphMargin: true,
          overviewRulerBorder: false,
          scrollBeyondLastLine: false,
          renderWhitespace: 'none',
          renderControlCharacters: false,
          wrappingStrategy: 'simple',
          automaticLayout: true,
          renderLineHighlight: 'none'
        });
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        setTimeout(() => {
          try {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
            editor.layout();
            editor.render(true);
            
            // –ù–∞—Ö–æ–¥–∏–º –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é
            const editorDom = editor.getDomNode();
            if (editorDom) {
              // –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ª–∏–Ω–∏—è–º–∏ —Ç–µ–∫—Å—Ç–∞
              const viewLines = editorDom.querySelector('.view-lines');
              if (viewLines) {
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º CSS —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–∞–ø—Ä—è–º—É—é
                viewLines.setAttribute('style', 
                  'white-space: pre !important; ' +
                  'overflow-x: visible !important; ' +
                  'overflow-y: hidden !important; ' +
                  'word-wrap: normal !important; ' +
                  'word-break: normal !important;'
                );
                
                // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã—Å–æ—Ç—É
                const lines = viewLines.querySelectorAll('.view-line');
                lines.forEach(line => {
                  line.setAttribute('style',
                    'white-space: pre !important; ' + 
                    'height: 18px !important; ' +
                    'line-height: 18px !important; ' +
                    'overflow: visible !important; ' +
                    'position: relative !important;'
                  );
                });
              }
            }
          } catch (err) {
            console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä—è–º–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ DOM —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:', err);
          }
        }, 10);
        } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤ applyNoLineWrap:', error);
      }
    };

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –∫–æ –≤—Å–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    setTimeout(() => {
      try {
        if (window.monaco && window.monaco.editor) {
          const editors = window.monaco.editor.getEditors();
          editors.forEach(editor => {
            if (window.applyNoLineWrap) {
              window.applyNoLineWrap(editor);
            }
          });
        }
      } catch (err) {
        console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∏–ª–µ–π –∫–æ –≤—Å–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º:', err);
      }
    }, 500);

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    monaco.editor.onDidCreateEditor(editor => {
      if (window.applyNoLineWrap) {
        window.applyNoLineWrap(editor);
      }
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    window.addEventListener('python-diagnostics-updated', () => {
      setTimeout(() => {
        try {
          if (window.monaco && window.monaco.editor) {
            const editors = window.monaco.editor.getEditors();
            editors.forEach(editor => {
              if (window.applyNoLineWrap) {
                window.applyNoLineWrap(editor);
              }
            });
          }
        } catch (err) {
          console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∏–ª–µ–π –ø–æ—Å–ª–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:', err);
        }
      }, 50);
    });

    // –°–æ–∑–¥–∞–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–æ–≥–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤—ã—Å–æ—Ç—ã —Å—Ç—Ä–æ–∫ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–æ—Å–æ–≤
    const strictErrorStyleId = 'monaco-strict-line-height-styles';
    if (!document.getElementById(strictErrorStyleId)) {
      const style = document.createElement('style');
      style.id = strictErrorStyleId;
      style.innerHTML = `
        /* –§–∏–∫—Å–∏—Ä—É–µ–º –ª–∏–Ω–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Å –∞–±—Å–æ–ª—é—Ç–Ω–æ–π –∂–µ—Å—Ç–∫–æ—Å—Ç—å—é */
        .monaco-editor,
        .monaco-editor-background,
        .monaco-editor .inputarea.ime-input {
          word-wrap: normal !important;
          white-space: pre !important;
        }
        
        /* –°—Ç—Ä–æ–∫–∏ –≤—Å–µ–≥–¥–∞ –∏–º–µ—é—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤—ã—Å–æ—Ç—É –∏ –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è */
        .monaco-editor .view-line,
        .monaco-editor .view-lines,
        .monaco-editor .view-line span {
          display: inline-block !important;
          white-space: pre !important;
          word-wrap: normal !important;
          overflow-x: visible !important;
          overflow-y: hidden !important;
          height: 18px !important;
          min-height: 18px !important;
          max-height: 18px !important;
          line-height: 18px !important;
        }
        
        /* –¢–µ–∫—Å—Ç–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –º–µ–Ω—è—Ç—å —Å–≤–æ—é —Ñ–æ—Ä–º—É */
        .monaco-editor .mtk1, .monaco-editor .mtk2, .monaco-editor .mtk3,
        .monaco-editor .mtk4, .monaco-editor .mtk5, .monaco-editor .mtk6,
        .monaco-editor .mtk7, .monaco-editor .mtk8, .monaco-editor .mtk9 {
          display: inline-block !important;
          white-space: pre !important;
          word-wrap: normal !important;
        }
        
        /* –û—à–∏–±–∫–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ–≥–æ –ø–æ–ª–æ–∂–µ–Ω–∏—è */
        .monaco-editor .cdr,
        .monaco-editor .cslr,
        .monaco-editor .detected-link,
        .monaco-editor .selected-text {
          border: none !important;
          background: transparent !important;
          position: static !important;
          display: inline !important;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫ –¥–æ–ª–∂–µ–Ω —Å–∫—Ä–æ–ª–ª–∏—Ç—å—Å—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
        .monaco-scrollable-element {
          overflow-x: auto !important;
          overflow-y: auto !important;
        }
        
        /* –°—Ç–∏–ª–∏ —Å—Ç—Ä–æ–∫ —Å –æ—à–∏–±–∫–∞–º–∏ - —Ç–æ–ª—å–∫–æ –Ω–∏–∂–Ω–µ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ */
        .monaco-editor .error-text,
        .monaco-editor .warning-text {
          border-bottom: 2px wavy !important;
          text-decoration: none !important;
          background: transparent !important;
          display: inline !important;
          position: static !important;
        }
        
        .monaco-editor .error-text {
          border-bottom-color: #FF4C4C !important;
        }
        
        .monaco-editor .warning-text {
          border-bottom-color: #FFCC00 !important;
        }
      `;
      document.head.appendChild(style);
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    window.addEventListener('resize', () => {
      setTimeout(() => {
        if (window.monaco && window.monaco.editor) {
          const editors = window.monaco.editor.getEditors();
          editors.forEach(editor => {
            try {
              editor.layout();
              
              // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∂–∏–º –±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫
              editor.updateOptions({
                wordWrap: 'off',
                lineHeight: 18,
                renderLineHighlight: 'none',
                automaticLayout: true
              });
            } catch (err) {
              console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞:', err);
            }
          });
        }
      }, 100);
    });

    /**
     * –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫
     */
    function applyAllErrorStyles() {
      // –î–æ–±–∞–≤–ª—è–µ–º CSS —Å—Ç–∏–ª–∏ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫
      const fixDisplayErrorStyles = document.createElement('style');
      fixDisplayErrorStyles.id = 'monaco-fix-error-display-styles';
      fixDisplayErrorStyles.innerHTML = `
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—Ä–µ—â–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –≤–æ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ */
        .monaco-editor,
        .monaco-editor-background,
        .monaco-editor .view-lines,
        .monaco-editor .view-line,
        .monaco-editor .view-line span,
        .monaco-editor .lines-content,
        .monaco-editor .monaco-editor-background {
          white-space: pre !important;
          word-wrap: normal !important;
          overflow-wrap: normal !important;
          word-break: normal !important;
          user-select: text !important;
          display: block !important;
        }
        
        /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–æ–∫ */
        .monaco-editor .view-line {
          height: 18px !important;
          min-height: 18px !important;
          max-height: 18px !important;
          line-height: 18px !important;
          position: relative !important;
          overflow-x: visible !important;
          overflow-y: hidden !important;
        }
        
        /* –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è */
        .monaco-editor .view-line span,
        .monaco-editor span {
          white-space: pre !important;
          display: inline-block !important;
          height: 18px !important;
          line-height: 18px !important;
        }
        
        /* –ì–ª–∏—Ñ—ã –æ—à–∏–±–æ–∫ –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –∏–º–µ—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω—É—é –≤—ã—Å–æ—Ç—É */
        .monaco-editor .margin-view-overlays .cgmr {
          height: 18px !important;
          position: relative !important;
        }
        
        /* –í–º–µ—Å—Ç–æ –∑–∞–ª–∏–≤–∫–∏ —Ñ–æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ */
        .monaco-editor .error-text,
        .monaco-editor .warning-text {
          text-decoration: wavy underline !important;
          text-decoration-skip-ink: none !important;
          border: none !important;
          background: transparent !important;
          display: inline !important;
          white-space: pre !important;
        }
        
        .monaco-editor .error-text {
          text-decoration-color: #F14C4C !important;
        }
        
        .monaco-editor .warning-text {
          text-decoration-color: #CCA700 !important;
        }
        
        /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ —Ä–∞–º–∫–∏ –∏ —Ü–≤–µ—Ç–Ω—ã–µ —Ñ–æ–Ω—ã */
        .monaco-editor .cdr,
        .monaco-editor .cslr {
          border: none !important;
          background: transparent !important;
        }
      `;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ —Å—Ç–∏–ª—è
      if (!document.getElementById('monaco-fix-error-display-styles')) {
        document.head.appendChild(fixDisplayErrorStyles);
      }
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –∫–æ –≤—Å–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º
      if (window.monaco && window.monaco.editor) {
        const editors = window.monaco.editor.getEditors();
        editors.forEach(editor => {
          if (editor) {
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–ø—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫
            editor.updateOptions({
              wordWrap: 'off',
              lineHeight: 18,
              glyphMargin: true,
              scrollBeyondLastLine: false,
              renderLineHighlight: 'none',
              folding: false
            });
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
            try {
              editor.layout();
              editor.render(true);
            } catch (err) {
              console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:', err);
            }
          }
        });
      }
    }

    // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (typeof document !== 'undefined') {
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(applyAllErrorStyles, 500);
      } else {
        document.addEventListener('DOMContentLoaded', () => setTimeout(applyAllErrorStyles, 500));
      }
      document.addEventListener('load', () => setTimeout(applyAllErrorStyles, 500));
    }

    // –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ —Å–Ω–æ–≤–∞
    window.addEventListener('python-diagnostics-updated', () => {
      setTimeout(applyAllErrorStyles, 100);
    });

    // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞ —Ç–∞–∫–∂–µ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏
    window.addEventListener('resize', () => {
      setTimeout(applyAllErrorStyles, 100);
    });

    /**
     * –°–æ–∑–¥–∞–µ—Ç –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤, —Ä–∞–∑–º–µ—â–∞—è –∏—Ö –ù–ê–î —Ç–µ–∫—Å—Ç–æ–º
     */
    function createNonInvasiveDecorations(markers, model) {
      if (!markers || !Array.isArray(markers) || markers.length === 0) return [];
      
      return markers.map(marker => {
        if (!marker) return null;
        
        const isError = marker.severity === monaco.MarkerSeverity.Error;
        const lineNumber = marker.startLineNumber || 1;
        
        // –°–æ–∑–¥–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ù–ê–î —Ç–µ–∫—Å—Ç–æ–º
        return {
          range: new monaco.Range(
            lineNumber, 1,
            lineNumber, 1
          ),
          options: {
            isWholeLine: true,
            className: isError ? 'error-line-above' : 'warning-line-above',
            glyphMarginClassName: isError ? 'error-glyph' : 'warning-glyph',
            overviewRuler: {
              color: isError ? '#FF4C4C' : '#FFCC00',
              position: monaco.editor.OverviewRulerLane.Right
            },
            minimap: {
              color: isError ? '#FF4C4C' : '#FFCC00',
              position: monaco.editor.MinimapPosition.Inline
            },
            stickiness: monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges
          }
        };
      }).filter(Boolean);
    }

    /**
     * –û–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫, —Ä–∞–∑–º–µ—â–∞—è –∏—Ö –ù–ê–î —Ç–µ–∫—Å—Ç–æ–º
     */
    function setupNonInvasiveErrorDecorations(editor) {
      try {
        if (!editor) return;
        
        const model = editor.getModel();
        if (!model) return;
        
        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–ø—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        editor.updateOptions({
          glyphMargin: true,
          lineHeight: 18,
          lineDecorationsWidth: 10
        });
        
        // –ü–æ–ª—É—á–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è —Ç–µ–∫—É—â–µ–π –º–æ–¥–µ–ª–∏
        const markers = monaco.editor.getModelMarkers({ resource: model.uri });
        if (!markers || markers.length === 0) {
          // –û—á–∏—â–∞–µ–º –≤—Å–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ—Ç
          editor.deltaDecorations(
            editor.getModel()?.getAllDecorations().map(d => d.id) || [], 
            []
          );
          return;
        }
        
        // –°–æ–∑–¥–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç —Å —Ç–µ–∫—Å—Ç–æ–º
        const decorations = createNonInvasiveDecorations(markers, model);
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏, –∑–∞–º–µ–Ω—è—è —Å—Ç–∞—Ä—ã–µ
        const oldDecorations = editor.getModel()?.getAllDecorations() || [];
        const oldDecorationIds = oldDecorations
          .filter(d => 
            d.options.className === 'error-line-above' || 
            d.options.className === 'warning-line-above'
          )
          .map(d => d.id);
        
        editor.deltaDecorations(oldDecorationIds, decorations);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
        markers.forEach(marker => {
          if (!model) return;
          
          const lineContent = model.getLineContent(marker.startLineNumber);
          const hoverMessage = {
            value: marker.message,
            isTrusted: true
          };
          
          // –°–æ–∑–¥–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
          monaco.editor.createDecorationsCollection([{
            range: new monaco.Range(
              marker.startLineNumber, 
              marker.startColumn, 
              marker.endLineNumber,
              marker.endColumn
            ),
            options: {
              hoverMessage: hoverMessage
            }
          }]);
        });
        } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–π:', error);
      }
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ CSS —Å—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –Ω–∞–¥ —Ç–µ–∫—Å—Ç–æ–º
    const aboveTextErrorStyleId = 'monaco-above-text-error-styles';
    if (!document.getElementById(aboveTextErrorStyleId)) {
      const style = document.createElement('style');
      style.id = aboveTextErrorStyleId;
      style.innerHTML = `
        /* –¢–æ–Ω–∫–∞—è –ø–æ–ª–æ—Å–∞ –Ω–∞–¥ —Å—Ç—Ä–æ–∫–æ–π —Å –æ—à–∏–±–∫–æ–π */
        .monaco-editor .error-line-above {
          border-top: 2px solid #FF4C4C !important;
          background: transparent !important;
          margin-top: -2px !important;
          z-index: 100 !important;
          pointer-events: none !important;
        }
        
        .monaco-editor .warning-line-above {
          border-top: 2px solid #FFCC00 !important;
          background: transparent !important;
          margin-top: -2px !important;
          z-index: 100 !important;
          pointer-events: none !important;
        }
        
        /* –ì–ª–∏—Ñ—ã –Ω–∞ –ø–æ–ª—è—Ö - –º–∞–ª–µ–Ω—å–∫–∏–µ –∫–≤–∞–¥—Ä–∞—Ç—ã */
        .monaco-editor .error-glyph {
          background-color: #FF4C4C !important;
          width: 4px !important;
          height: 18px !important;
          margin-left: 2px !important;
          z-index: 100 !important;
        }
        
        .monaco-editor .warning-glyph {
          background-color: #FFCC00 !important;
          width: 4px !important;
          height: 18px !important;
          margin-left: 2px !important;
          z-index: 100 !important;
        }
        
        /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ —Ñ–æ–Ω–æ–≤—ã–µ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è */
        .monaco-editor .cdr,
        .monaco-editor .cslr,
        .monaco-editor .squiggly-error,
        .monaco-editor .squiggly-warning,
        .monaco-editor .error-text,
        .monaco-editor .warning-text {
          background: transparent !important;
          border: none !important;
          text-decoration: none !important;
          border-bottom: none !important;
        }
        
        /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–æ–∫ */
        .monaco-editor .view-line {
          position: relative !important;
          height: 18px !important;
          line-height: 18px !important;
          white-space: pre !important;
          overflow-x: visible !important;
          overflow-y: hidden !important;
        }
      `;
      document.head.appendChild(style);
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–µ–∫–æ—Ä–∞—Ü–∏–π
    window.setupErrorDecorations = setupNonInvasiveErrorDecorations;

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –≤—ã–∑—ã–≤–∞–µ–º—É—é –¥–ª—è –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
    window.setupAllErrorDecorations = () => {
      if (window.monaco && window.monaco.editor) {
        const editors = window.monaco.editor.getEditors();
        editors.forEach(editor => {
          if (window.setupErrorDecorations) {
            window.setupErrorDecorations(editor);
          }
        });
      }
    };

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –¥–µ–∫–æ—Ä–∞—Ü–∏–π
    window.forceUpdateAllDecorations = () => {
      try {
        if (window.monaco && window.monaco.editor) {
          const editors = window.monaco.editor.getEditors();
          let count = 0;
          
          editors.forEach(editor => {
            if (window.setupErrorDecorations) {
              window.setupErrorDecorations(editor);
              count++;
            }
          });
          
          return count;
        }
        return 0;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–π:', error);
        return 0;
      }
    };

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–µ–∫–æ—Ä–∞—Ü–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    window.addEventListener('python-diagnostics-updated', () => {
      setTimeout(() => {
        if (window.forceUpdateAllDecorations) {
          window.forceUpdateAllDecorations();
        }
      }, 100);
    });

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function applyErrorStylesOnLoad() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π
      if (window.monaco && window.monaco.editor) {
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—à–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –∫–æ –≤—Å–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º
        if (window.forceUpdateAllDecorations) {
          window.forceUpdateAllDecorations();
        }
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –∫–æ –≤—Å–µ–º –Ω–æ–≤—ã–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º
        monaco.editor.onDidCreateEditor(editor => {
          setTimeout(() => {
            if (window.setupErrorDecorations) {
              window.setupErrorDecorations(editor);
            }
          }, 100);
        });
      }
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (typeof document !== 'undefined') {
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(applyErrorStylesOnLoad, 500);
      } else {
        document.addEventListener('DOMContentLoaded', () => {
          setTimeout(applyErrorStylesOnLoad, 500);
        });
      }
      
      // –¢–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
      window.addEventListener('load', () => {
        setTimeout(applyErrorStylesOnLoad, 1000);
      });
    }

    /**
     * –°–æ–∑–¥–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç —Ç–µ–∫—Å—Ç
     */
    function createMinimalisticErrorDecorations(markers, model) {
      if (!markers || markers.length === 0) return [];
      
      const decorations = [];
      
      markers.forEach(marker => {
        // –¢–∏–ø –æ—à–∏–±–∫–∏
        const isError = marker.severity === monaco.MarkerSeverity.Error;
        
        // 1. –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏—é –Ω–∞ –ø–æ–ª–µ —Å–ª–µ–≤–∞ (marginDecoration)
        decorations.push({
          range: new monaco.Range(
            marker.startLineNumber, 1,
            marker.startLineNumber, 1
          ),
          options: {
            glyphMarginClassName: isError ? 'minimal-error-glyph' : 'minimal-warning-glyph',
            stickiness: monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges
          }
        });
        
        // 2. –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–Ω–∫—É—é –ª–∏–Ω–∏—é –Ω–∞ –ø–æ–ª–æ—Å–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ (overviewRuler)
        decorations.push({
          range: new monaco.Range(
            marker.startLineNumber, 1,
            marker.startLineNumber, model.getLineMaxColumn(marker.startLineNumber)
          ),
          options: {
            overviewRuler: {
              color: isError ? '#FF4C4C' : '#FFCC00',
              position: monaco.editor.OverviewRulerLane.Right
            },
            stickiness: monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges
          }
        });
        
        // 3. –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (hoverMessage)
        decorations.push({
          range: new monaco.Range(
            marker.startLineNumber, marker.startColumn,
            marker.endLineNumber, marker.endColumn
          ),
          options: {
            hoverMessage: {
              value: marker.message,
              isTrusted: true
            },
            inlineClassName: 'minimal-error-hint',
            stickiness: monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges
          }
        });
      });
      
      return decorations;
    }

    /**
     * –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä—É
     */
    function applyMinimalisticErrorDecorations(editor) {
      if (!editor) return;
      
      const model = editor.getModel();
      if (!model) return;
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–ø—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
      editor.updateOptions({
        glyphMargin: true,
        lineHeight: 18,
        lineDecorationsWidth: 10
      });
      
      // –ü–æ–ª—É—á–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã
      const markers = monaco.editor.getModelMarkers({ resource: model.uri });
      
      // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      const oldDecorations = editor.getModel()?.getAllDecorations() || [];
      const oldDecorationIds = oldDecorations
        .filter(d => {
          const className = d.options?.className || '';
          const glyphClassName = d.options?.glyphMarginClassName || '';
          return className.includes('error') || 
                 className.includes('warning') ||
                 glyphClassName.includes('error') ||
                 glyphClassName.includes('warning');
        })
        .map(d => d.id);
      
      // –ï—Å–ª–∏ –Ω–µ—Ç –æ—à–∏–±–æ–∫, –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      if (!markers || markers.length === 0) {
        editor.deltaDecorations(oldDecorationIds, []);
        return;
      }
      
      // –°–æ–∑–¥–∞–µ–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –Ω–æ–≤—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      const decorations = createMinimalisticErrorDecorations(markers, model);
      editor.deltaDecorations(oldDecorationIds, decorations);
    }

    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö –¥–µ–∫–æ—Ä–∞—Ü–∏–π
    const minimalisticErrorStyleId = 'monaco-minimalistic-error-styles';
    if (!document.getElementById(minimalisticErrorStyleId)) {
      const style = document.createElement('style');
      style.id = minimalisticErrorStyleId;
      style.innerHTML = `
        /* –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –Ω–∞ –ø–æ–ª—è—Ö - —Ç–æ–Ω–∫–∏–µ –ª–∏–Ω–∏–∏ */
        .monaco-editor .minimal-error-glyph {
          margin-left: 5px;
          width: 3px !important;
          background-color: #FF4C4C;
          height: 18px !important;
        }
        
        .monaco-editor .minimal-warning-glyph {
          margin-left: 5px;
          width: 3px !important;
          background-color: #FFCC00;
          height: 18px !important;
        }
        
        /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫ */
        .monaco-editor .squiggly-error,
        .monaco-editor .squiggly-warning,
        .monaco-editor .error-text,
        .monaco-editor .warning-text,
        .monaco-editor .error-line-above,
        .monaco-editor .warning-line-above,
        .monaco-editor .error-decoration,
        .monaco-editor .warning-decoration {
          background: transparent !important;
          border: none !important;
          text-decoration: none !important;
        }
        
        /* –£–±–∏—Ä–∞–µ–º –≤—Å–µ —Ü–≤–µ—Ç–Ω—ã–µ —Ñ–æ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–ª–∏—è—Ç—å –Ω–∞ —Ç–µ–∫—Å—Ç */
        .monaco-editor .cdr,
        .monaco-editor .cslr,
        .monaco-editor .detected-link,
        .monaco-editor .selected-text {
          background: transparent !important;
          border: none !important;
        }
        
        /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–æ–∫ */
        .monaco-editor .view-line {
          height: 18px !important;
          line-height: 18px !important;
          white-space: pre !important;
        }
      `;
      document.head.appendChild(style);
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö –¥–µ–∫–æ—Ä–∞—Ü–∏–π
    window.setupErrorDecorations = applyMinimalisticErrorDecorations;

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–µ–∫–æ—Ä–∞—Ü–∏–π –∫–æ –≤—Å–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º
    window.setupAllErrorDecorations = () => {
      if (window.monaco && window.monaco.editor) {
        const editors = window.monaco.editor.getEditors();
        editors.forEach(editor => {
          if (window.setupErrorDecorations) {
            window.setupErrorDecorations(editor);
          }
        });
      }
    };

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–µ–∫–æ—Ä–∞—Ü–∏–π
    window.forceUpdateAllDecorations = () => {
      try {
        if (window.monaco && window.monaco.editor) {
          const editors = window.monaco.editor.getEditors();
          editors.forEach(editor => {
            if (window.setupErrorDecorations) {
              window.setupErrorDecorations(editor);
            }
          });
        }
  } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–π:', error);
      }
    };

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    if (typeof document !== 'undefined') {
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(window.forceUpdateAllDecorations, 500);
      } else {
        document.addEventListener('DOMContentLoaded', () => {
          setTimeout(window.forceUpdateAllDecorations, 500);
        });
      }
      
      window.addEventListener('load', () => {
        setTimeout(window.forceUpdateAllDecorations, 1000);
      });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
    monaco.editor.onDidCreateEditor(editor => {
      setTimeout(() => {
        if (window.setupErrorDecorations) {
          window.setupErrorDecorations(editor);
        }
      }, 100);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    window.addEventListener('python-diagnostics-updated', () => {
      setTimeout(window.forceUpdateAllDecorations, 100);
    });

    /**
     * –£–ª—å—Ç—Ä–∞-–º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–≤—Å–µ–º –Ω–µ —Ç—Ä–æ–≥–∞—é—Ç —Ç–µ–∫—Å—Ç
     */
    function ultraMinimalDecorations(editor) {
      if (!editor || !editor.getModel) return;
      
      const model = editor.getModel();
      if (!model) return;
      
      // –°–Ω–∞—á–∞–ª–∞ –æ—á–∏—â–∞–µ–º –≤—Å–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      const existingDecorations = editor.getModel().getAllDecorations();
      const oldIds = existingDecorations
        .filter(d => d.options.glyphMarginClassName || 
                    d.options.overviewRulerColor ||
                    d.options.className && 
                    (d.options.className.includes('error') || 
                     d.options.className.includes('warning')))
        .map(d => d.id);
      
      // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –º–æ–¥–µ–ª–∏
      const markers = monaco.editor.getModelMarkers({ resource: model.uri });
      if (!markers || markers.length === 0) {
        // –ï—Å–ª–∏ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ –æ—á–∏—â–∞–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
        editor.deltaDecorations(oldIds, []);
        return;
      }
      
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –¥–ª—è –º–∞—Ä–∫–µ—Ä–æ–≤
      const newDecorations = [];
      
      // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ —Å —Ç–µ–∫—Å—Ç–∞
      editor.deltaDecorations(oldIds, []);
      
      // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞ —Å–æ–∑–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –º–∞—Ä–∫–µ—Ä –Ω–∞ –ø–æ–ª–µ –∏ –≤ –ø–æ–ª–æ—Å–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
      markers.forEach(marker => {
        const isError = marker.severity === monaco.MarkerSeverity.Error;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ–ª–µ —Å–ª–µ–≤–∞
        newDecorations.push({
          range: new monaco.Range(
            marker.startLineNumber, 1,
            marker.startLineNumber, 1
          ),
          options: {
            isWholeLine: false,
            glyphMarginClassName: isError ? 'ultra-minimal-error' : 'ultra-minimal-warning',
            overviewRuler: {
              color: isError ? '#FF4C4C80' : '#FFCC0080',
              position: monaco.editor.OverviewRulerLane.Right
            },
            minimap: {
              color: isError ? '#FF4C4C' : '#FFCC00',
              position: monaco.editor.MinimapPosition.Inline
            },
            hoverMessage: { value: marker.message }
          }
        });
      });
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      editor.deltaDecorations([], newDecorations);

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–ø—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
      editor.updateOptions({
        lineHeight: 18,
        glyphMargin: true,
        lineDecorationsWidth: 10,
        lineNumbers: 'on',
        renderWhitespace: 'none',
        wordWrap: 'off'
      });
    }

    // –î–æ–±–∞–≤–ª—è–µ–º CSS —Å—Ç–∏–ª–∏ –¥–ª—è —É–ª—å—Ç—Ä–∞-–º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö –¥–µ–∫–æ—Ä–∞—Ü–∏–π
    const ultraMinimalStyleId = 'monaco-ultra-minimal-error-styles';
    if (!document.getElementById(ultraMinimalStyleId)) {
      const style = document.createElement('style');
      style.id = ultraMinimalStyleId;
      style.innerHTML = `
        /* –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å—Ç–∏–ª–µ–π –æ—à–∏–±–æ–∫ */
        .monaco-editor .squiggly-error,
        .monaco-editor .squiggly-warning,
        .monaco-editor .squiggly-info,
        .monaco-editor .error-text,
        .monaco-editor .warning-text,
        .monaco-editor .error-decoration,
        .monaco-editor .warning-decoration,
        .monaco-editor .error-line-above,
        .monaco-editor .warning-line-above,
        .monaco-editor span[class*="error"],
        .monaco-editor span[class*="warning"],
        .monaco-editor .cdr,
        .monaco-editor .cslr {
          background: transparent !important;
          border: none !important;
          border-bottom: none !important;
          border-top: none !important;
          text-decoration: none !important;
          color: inherit !important;
        }
        
        /* –£–ª—å—Ç—Ä–∞-–º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –º–∞—Ä–∫–µ—Ä –Ω–∞ –ø–æ–ª—è—Ö - —Ç–æ–Ω–∫–∞—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è */
        .monaco-editor .ultra-minimal-error {
          border-left: 3px solid #FF4C4C !important;
          width: 0 !important;
          height: 18px !important;
          margin-left: 4px !important;
        }
        
        .monaco-editor .ultra-minimal-warning {
          border-left: 3px solid #FFCC00 !important;
          width: 0 !important;
          height: 18px !important;
          margin-left: 4px !important;
        }
        
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∏–ª–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–ª–∏—è—Ç—å –Ω–∞ —Ç–µ–∫—Å—Ç */
        .monaco-editor .view-overlays,
        .monaco-editor .view-zones,
        .monaco-editor .margin-view-overlays {
          pointer-events: none !important;
        }
        
        /* –û—Ç–∫–ª—é—á–∞–µ–º —Å–ª–æ–∏ –º–∞—Ä–∫–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–ª–∏—è—Ç—å –Ω–∞ —Ç–µ–∫—Å—Ç */
        .monaco-editor .lines-decorations,
        .monaco-editor .lines-content,
        .monaco-editor .view-lines {
          z-index: 0 !important;
          position: relative !important;
        }
        
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –≤—Å–ø–ª—ã–≤–∞—é—â–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .monaco-editor .monaco-hover { 
          z-index: 50 !important;
          position: absolute !important;
          top: auto !important;
          left: auto !important;
        }
      `;
      document.head.appendChild(style);
    }

    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —É–ª—å—Ç—Ä–∞-–º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã—Ö –¥–µ–∫–æ—Ä–∞—Ü–∏–π
    window.setupErrorDecorations = ultraMinimalDecorations;

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
    window.setupAllErrorDecorations = () => {
      if (window.monaco && window.monaco.editor) {
        const editors = window.monaco.editor.getEditors();
        editors.forEach(editor => {
          ultraMinimalDecorations(editor);
        });
      }
    };

    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Ñ–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    window.forceUpdateAllDecorations = () => {
      try {
        if (window.monaco && window.monaco.editor) {
          const editors = window.monaco.editor.getEditors();
          editors.forEach(editor => {
            ultraMinimalDecorations(editor);
          });
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–π:', error);
      }
    };

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —É–ª—å—Ç—Ä–∞-–º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –∫–æ –≤—Å–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    if (typeof document !== 'undefined') {
      if (document.readyState === 'complete' || document.readyState === 'interactive') {
        setTimeout(() => { 
          if (window.forceUpdateAllDecorations) {
            window.forceUpdateAllDecorations();
          }
        }, 500);
      } else {
        document.addEventListener('DOMContentLoaded', () => {
          setTimeout(() => {
            if (window.forceUpdateAllDecorations) {
              window.forceUpdateAllDecorations();
            }
          }, 500);
        });
      }
      
      window.addEventListener('load', () => {
        setTimeout(() => {
          if (window.forceUpdateAllDecorations) {
            window.forceUpdateAllDecorations();
          }
        }, 1000);
      });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
    monaco.editor.onDidCreateEditor(editor => {
      setTimeout(() => {
        ultraMinimalDecorations(editor);
      }, 100);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    window.addEventListener('python-diagnostics-updated', () => {
      setTimeout(() => {
        if (window.forceUpdateAllDecorations) {
          window.forceUpdateAllDecorations();
        }
      }, 100);
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –æ—á–∏—â–µ–Ω–∏—è –≤—Å–µ—Ö –¥–µ–∫–æ—Ä–∞—Ü–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    monaco.editor.onDidChangeModelContent(event => {
      const model = event.model;
      if (model) {
        const uri = model.uri.toString();
        // –û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–π –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        setTimeout(() => {
          const editors = monaco.editor.getEditors();
          editors.forEach(editor => {
            if (editor.getModel()?.uri.toString() === uri) {
              ultraMinimalDecorations(editor);
            }
          });
        }, 500);
      }
    });

    // –ë–ª–æ–∫–∏—Ä—É–µ–º –ª—é–±—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫
    const preventStandardDecorations = () => {
      // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–æ–¥ setModelMarkers, —á—Ç–æ–±—ã —É–±—Ä–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      const originalSetModelMarkers = monaco.editor.setModelMarkers;
      monaco.editor.setModelMarkers = (model, owner, markers) => {
        // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞—Ä–∫–µ—Ä–æ–≤
        originalSetModelMarkers(model, owner, markers);
        
        // –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–∞—Ä–∫–µ—Ä–æ–≤ —Å—Ä–∞–∑—É –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã —Å —ç—Ç–æ–π –º–æ–¥–µ–ª—å—é
        setTimeout(() => {
          const editors = monaco.editor.getEditors();
          editors.forEach(editor => {
            if (editor.getModel() === model) {
              ultraMinimalDecorations(editor);
            }
          });
        }, 0);
      };
    };

    // –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –¥–µ–∫–æ—Ä–∞—Ü–∏–π
    preventStandardDecorations();

    /**
     * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–æ–Ω–∫–∏—Ö –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–π –≤–º–µ—Å—Ç–æ –ø–æ–ª–æ—Å
     */
    function applyThinUnderlineDecorations(editor) {
      if (!editor || !editor.getModel) return;
      
      const model = editor.getModel();
      if (!model) return;
      
      // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      const allDecorations = editor.getModel().getAllDecorations();
      const ids = allDecorations.map(d => d.id);
      editor.deltaDecorations(ids, []);
      
      // –ü–æ–ª—É—á–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã
      const markers = monaco.editor.getModelMarkers({ resource: model.uri });
      if (!markers || markers.length === 0) return;
      
      // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ —Å –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ–º
      const decorations = markers.map(marker => ({
        range: new monaco.Range(
          marker.startLineNumber,
          marker.startColumn,
          marker.endLineNumber,
          marker.endColumn
        ),
        options: {
          inlineClassName: marker.severity === monaco.MarkerSeverity.Error ? 
                           'thin-error-underline' : 'thin-warning-underline',
          hoverMessage: { value: marker.message },
          minimap: {
            color: marker.severity === monaco.MarkerSeverity.Error ? 
                   '#FF4C4C' : '#FFCC00',
            position: monaco.editor.MinimapPosition.Inline
          },
          overviewRuler: {
            color: marker.severity === monaco.MarkerSeverity.Error ? 
                   '#FF4C4C' : '#FFCC00',
            position: monaco.editor.OverviewRulerLane.Right
          }
        }
      }));
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ
      editor.deltaDecorations([], decorations);
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω—É–∂–Ω—ã–µ –æ–ø—Ü–∏–∏
      editor.updateOptions({
        lineHeight: 18,
        glyphMargin: true,
        lineDecorationsWidth: 10,
        wordWrap: 'off'
      });
    }

    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–æ–Ω–∫–æ–≥–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
    const thinUnderlineStyleId = 'monaco-thin-underline-styles';
    if (!document.getElementById(thinUnderlineStyleId)) {
      const style = document.createElement('style');
      style.id = thinUnderlineStyleId;
      style.innerHTML = `
        /* –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∏–ª–∏ –æ—à–∏–±–æ–∫ */
        .monaco-editor .squiggly-error,
        .monaco-editor .squiggly-warning,
        .monaco-editor .error-text,
        .monaco-editor .warning-text,
        .monaco-editor .cdr,
        .monaco-editor .cslr,
        .monaco-editor span[class*="error-"],
        .monaco-editor span[class*="warning-"] {
          background: transparent !important;
          background-color: transparent !important;
          border: none !important;
          border-radius: 0 !important;
          text-decoration: none !important;
        }
        
        /* –¢–æ–ª—å–∫–æ —Ç–æ–Ω–∫–æ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –æ—à–∏–±–æ–∫ */
        .monaco-editor .thin-error-underline {
          border-bottom: 1px solid #FF4C4C !important;
          box-shadow: none !important;
          background: transparent !important;
        }
        
        /* –¢–æ–Ω–∫–æ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π */
        .monaco-editor .thin-warning-underline {
          border-bottom: 1px solid #FFCC00 !important;
          box-shadow: none !important;
          background: transparent !important;
        }
        
        /* –§–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É —Å—Ç—Ä–æ–∫–∏ */
        .monaco-editor .view-line {
          height: 18px !important;
          line-height: 18px !important;
          white-space: pre !important;
        }
      `;
      document.head.appendChild(style);
    }

    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
    window.setupErrorDecorations = applyThinUnderlineDecorations;

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
    window.setupAllErrorDecorations = function() {
      if (window.monaco && window.monaco.editor) {
        const editors = window.monaco.editor.getEditors();
        editors.forEach(editor => {
          applyThinUnderlineDecorations(editor);
        });
      }
    };

    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    window.forceUpdateAllDecorations = function() {
      if (window.monaco && window.monaco.editor) {
        const editors = window.monaco.editor.getEditors();
        editors.forEach(editor => {
          applyThinUnderlineDecorations(editor);
        });
      }
    };

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º
    if (window.monaco && window.monaco.editor) {
      setTimeout(() => {
        window.setupAllErrorDecorations();
      }, 500);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    window.addEventListener('python-diagnostics-updated', () => {
      setTimeout(() => {
        window.setupAllErrorDecorations();
      }, 100);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
    monaco.editor.onDidCreateEditor(editor => {
      setTimeout(() => {
        applyThinUnderlineDecorations(editor);
      }, 100);
    });

    /**
     * –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –¥–µ–∫–æ—Ä–∞—Ü–∏–π –æ—à–∏–±–æ–∫ Monaco
     */
    function removeAllErrorDecorations(): void {
      // –°–æ–∑–¥–∞–µ–º —Å—Ç–∏–ª—å, –∫–æ—Ç–æ—Ä—ã–π —Å–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫
      const styleId = 'monaco-error-override-style';
      
      if (!document.getElementById(styleId)) {
        const style = document.createElement('style');
        style.id = styleId;
        style.innerHTML = `
          /* –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫ */
          .monaco-editor .squiggly-error,
          .monaco-editor .squiggly-warning,
          .monaco-editor .squiggly-info,
          .monaco-editor .squiggly-hint,
          .monaco-editor .error-text,
          .monaco-editor .warning-text,
          .monaco-editor .cdr,
          .monaco-editor .cslr,
          .monaco-editor span[class*="squiggly-"],
          .monaco-editor div[class*="squiggly-"],
          .monaco-editor .view-overlays .mtk-error,
          .monaco-editor .view-overlays .mtk-warn,
          .monaco-editor .view-overlays [class*="squiggly"],
          .monaco-editor .view-overlays [class*="error"],
          .monaco-editor .view-overlays [class*="warning"],
          .monaco-editor span[class*="error-"],
          .monaco-editor span[class*="warning-"],
          .monaco-editor div[class*="error-"],
          .monaco-editor div[class*="warning-"] {
            background: transparent !important;
            background-color: transparent !important;
            border: none !important;
            box-shadow: none !important;
            text-decoration: none !important;
            border-radius: 0 !important;
          }
          
          /* –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏ —Ñ–æ–Ω–æ–≤—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ */
          .monaco-editor .margin .margin-view-overlays .line-delete,
          .monaco-editor .margin .margin-view-overlays .line-insert,
          .monaco-editor .view-overlays .current-line,
          .monaco-editor .view-overlays .current-line-both,
          .monaco-editor .view-overlays .selection,
          .monaco-editor .view-overlays .view-line,
          .monaco-editor .view-overlays [class*="-line"] {
            background: transparent !important;
          }
          
          /* –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–Ω–∫—É—é –ª–∏–Ω–∏—é –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –¥–ª—è —Å—Ç—Ä–æ–∫ —Å –æ—à–∏–±–∫–∞–º–∏ */
          .monaco-editor .thin-error-underline {
            background: transparent !important;
            background-color: transparent !important;
            border-bottom: 1px solid #FF4C4C !important;
            box-shadow: none !important;
            position: relative !important;
            z-index: 100 !important;
          }
          
          /* –ü–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π */
          .monaco-editor .thin-warning-underline {
            background: transparent !important;
            background-color: transparent !important;
            border-bottom: 1px solid #FFCC00 !important;
            box-shadow: none !important;
            position: relative !important;
            z-index: 100 !important;
          }
          
          /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –Ω–∞–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ —Ñ–æ–Ω–∞ –Ω–∞ —Å—Ç—Ä–æ–∫–∏ */
          .monaco-editor .view-line span {
            background: transparent !important;
          }
        `;
        
        document.head.appendChild(style);
      }
    }

    /**
     * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —Ç–æ–Ω–∫–∏—Ö –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–π
     */
    function applyOnlyUnderlineDecorations(editor: monaco.editor.IStandaloneCodeEditor): void {
      if (!editor || !editor.getModel) return;
      
      const model = editor.getModel();
      if (!model) return;
      
      // –û—á–∏—â–∞–µ–º –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      const allDecorations = editor.getModel().getAllDecorations();
      const ids = allDecorations.map(d => d.id);
      editor.deltaDecorations(ids, []);
      
      // –ü–æ–ª—É—á–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã –æ—à–∏–±–æ–∫
      const markers = monaco.editor.getModelMarkers({ resource: model.uri });
      if (!markers || markers.length === 0) return;
      
      // –°–æ–∑–¥–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–Ω–∫–∏–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
      const decorations: monaco.editor.IModelDeltaDecoration[] = markers.map(marker => {
        // –°–æ–∑–¥–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
        const range = new monaco.Range(
          marker.startLineNumber,
          marker.startColumn,
          marker.endLineNumber,
          marker.endColumn
        );
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏
        const isError = marker.severity === monaco.MarkerSeverity.Error;
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –±–µ–∑ —Ñ–æ–Ω–∞
    return {
          range: range,
          options: {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ –∫–ª–∞—Å—Å –¥–ª—è –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
            inlineClassName: isError ? 'thin-error-underline' : 'thin-warning-underline',
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
            hoverMessage: { value: marker.message },
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –Ω–∞ –º–∏–Ω–∏-–∫–∞—Ä—Ç–µ
            minimap: {
              color: isError ? '#FF4C4C' : '#FFCC00',
              position: monaco.editor.MinimapPosition.Inline
            },
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –Ω–∞ –ø–æ–ª–æ—Å–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            overviewRuler: {
              color: isError ? '#FF4C4C' : '#FFCC00',
              position: monaco.editor.OverviewRulerLane.Right
            }
          }
        };
      });
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—à–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      editor.deltaDecorations([], decorations);
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –¥–ª—è –ª—É—á—à–µ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
      editor.updateOptions({
        lineHeight: 18,
        glyphMargin: true,
        lineDecorationsWidth: 10,
        wordWrap: 'off'
      });
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
      setTimeout(() => {
        editor.layout();
      }, 10);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞—à–∏ —Å—Ç–∏–ª–∏ –∏ —É–¥–∞–ª—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ
    removeAllErrorDecorations();

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–∞—Ä–∫–µ—Ä–æ–≤
    const originalSetModelMarkers = monaco.editor.setModelMarkers;

    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–æ–¥ setModelMarkers
    monaco.editor.setModelMarkers = function(
      model: monaco.editor.ITextModel, 
      owner: string, 
      markers: monaco.editor.IMarkerData[]
    ): void {
      // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥
      originalSetModelMarkers(model, owner, markers);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
      setTimeout(() => {
        if (window.monaco && window.monaco.editor) {
          const editors = window.monaco.editor.getEditors();
          editors.forEach((editor: monaco.editor.IStandaloneCodeEditor) => {
            if (editor && editor.getModel() === model) {
              applyOnlyUnderlineDecorations(editor);
            }
          });
        }
      }, 0);
      
      // –î–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª—è–µ–º —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
      setTimeout(() => {
        if (window.monaco && window.monaco.editor) {
          const editors = window.monaco.editor.getEditors();
          editors.forEach((editor: monaco.editor.IStandaloneCodeEditor) => {
            if (editor && editor.getModel() === model) {
              applyOnlyUnderlineDecorations(editor);
            }
          });
        }
      }, 50);
    };

    // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
    window.setupErrorDecorations = applyOnlyUnderlineDecorations;

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
    window.setupAllErrorDecorations = function(): void {
      if (window.monaco && window.monaco.editor) {
        const editors = window.monaco.editor.getEditors();
        editors.forEach((editor: monaco.editor.IStandaloneCodeEditor) => {
          applyOnlyUnderlineDecorations(editor);
        });
      }
    };

    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    window.forceUpdateAllDecorations = function(): void {
      removeAllErrorDecorations();
      if (window.monaco && window.monaco.editor) {
        const editors = window.monaco.editor.getEditors();
        editors.forEach((editor: monaco.editor.IStandaloneCodeEditor) => {
          applyOnlyUnderlineDecorations(editor);
        });
      }
    };

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞–º —Å—Ä–∞–∑—É –∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
    if (window.monaco && window.monaco.editor) {
      try {
        if (window.forceUpdateAllDecorations) {
          window.forceUpdateAllDecorations();
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–π:', e);
      }
      
      // –ü–æ–≤—Ç–æ—Ä—è–µ–º —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
      setTimeout(() => {
        try {
          window.forceUpdateAllDecorations();
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–π:', e);
        }
      }, 500);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    window.addEventListener('python-diagnostics-updated', () => {
      setTimeout(() => {
        try {
          window.forceUpdateAllDecorations();
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–π:', e);
        }
      }, 100);
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–≤
    monaco.editor.onDidCreateEditor((editor: monaco.editor.IStandaloneCodeEditor) => {
      setTimeout(() => {
        try {
          removeAllErrorDecorations();
          applyOnlyUnderlineDecorations(editor);
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–π –∫ –Ω–æ–≤–æ–º—É —Ä–µ–¥–∞–∫—Ç–æ—Ä—É:', e);
        }
      }, 100);
    });

    /**
     * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –¥–µ–∫–æ—Ä–∞—Ü–∏–π –æ—à–∏–±–æ–∫
     */
    function aggressiveErrorStyleRemoval() {
      // –°–æ–∑–¥–∞–µ–º —Å—Ç–∏–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∫–∞—Ç–µ–≥–æ—Ä–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–µ—â–∞–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –¥–µ–∫–æ—Ä–∞—Ü–∏–π
      const styleId = 'monaco-super-aggressive-error-override';
      
      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∂–µ–∫—Ü–∏–∏ —Å—Ç–∏–ª–µ–π —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
      const injectHighPriorityStyle = (css) => {
        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å—Ç–∏–ª—è
        const style = document.createElement('style');
        style.id = styleId + '-' + Math.random().toString(36).substring(2);
        style.innerHTML = css;
        style.setAttribute('data-priority', 'highest');
        
        // –í—Å—Ç–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –≤ –Ω–∞—á–∞–ª–æ head –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞
        if (document.head.firstChild) {
          document.head.insertBefore(style, document.head.firstChild);
        } else {
          document.head.appendChild(style);
        }
        
        return style;
      };
      
      // –ú–ï–¢–û–î 1: –ü–û–õ–ù–û–ï –ü–ï–†–ï–û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –°–¢–ò–õ–ï–ô –°–¢–†–û–ö –ò –ë–õ–û–ö–û–í
      injectHighPriorityStyle(`
        /* –ü–û–õ–ù–û–ï –£–î–ê–õ–ï–ù–ò–ï –ë–û–õ–¨–®–ò–• –õ–ò–ù–ò–ô (–ú–ï–¢–û–î 1) */
        
        /* –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫ */
        .monaco-editor .squiggly-error,
        .monaco-editor .squiggly-warning,
        .monaco-editor .squiggly-info,
        .monaco-editor .squiggly-hint,
        .monaco-editor .error-text,
        .monaco-editor .warning-text,
        .monaco-editor .cdr,
        .monaco-editor .cslr,
        .monaco-editor .view-overlays .cdr,
        .monaco-editor .view-overlays .cslr,
        .monaco-editor .view-overlays .line-with-error,
        .monaco-editor .view-overlays .current-diagnostic-row,
        .monaco-editor span[class*="squiggly-"],
        .monaco-editor div[class*="squiggly-"],
        .monaco-editor .view-overlays .mtk-error,
        .monaco-editor .view-overlays .mtk-warn,
        .monaco-editor .view-overlays [class*="squiggly"],
        .monaco-editor .view-overlays [class*="error"],
        .monaco-editor .view-overlays [class*="warning"],
        .monaco-editor span[class*="error-"],
        .monaco-editor span[class*="warning-"],
        .monaco-editor div[class*="error-"],
        .monaco-editor div[class*="warning-"] {
          opacity: 0 !important;
          background: transparent !important;
          background-color: transparent !important;
          border: none !important;
          box-shadow: none !important;
          text-decoration: none !important;
        }
        
        /* –¢–µ–ø–µ—Ä—å —è–≤–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ–Ω –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ */
        .monaco-editor .view-line,
        .monaco-editor .view-lines > div,
        .monaco-editor .view-lines .view-line,
        .monaco-editor .lines-content,
        .monaco-editor .lines-content .view-lines,
        .monaco-editor .view-overlays .view-line,
        .monaco-editor .view-overlays > div > div,
        .monaco-editor .view-overlays > div,
        .monaco-editor .view-overlays > div[class*="error"],
        .monaco-editor .view-overlays > div[class*="warning"],
        .monaco-editor .view-overlays > div[style*="background"],
        .monaco-editor .view-overlays > div[style*="background-color"] {
          background: transparent !important;
          background-color: transparent !important;
          background-image: none !important;
          border: none !important;
          box-shadow: none !important;
        }
        
        /* –ü–æ–¥–∞–≤–ª—è–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π line-height —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Ä–∞—Å—Ç—è–≥–∏–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ */
        .monaco-editor .view-line,
        .monaco-editor .view-lines .view-line,
        .monaco-editor .view-lines > div,
        .monaco-editor .lines-content,
        .monaco-editor .lines-content .view-lines {
          height: 18px !important;
          line-height: 18px !important;
          min-height: 18px !important;
          max-height: 18px !important;
        }
        
        /* –ù–∞—à–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è */
        .monaco-editor .thin-error-underline {
          border-bottom: 1px wavy #FF4C4C !important;
          background: transparent !important;
          background-color: transparent !important;
        }
        
        .monaco-editor .thin-warning-underline {
          border-bottom: 1px wavy #FFCC00 !important;
          background: transparent !important;
          background-color: transparent !important;
        }
      `);
      
      // –ú–ï–¢–û–î 2: CSS RESET –î–õ–Ø –ö–ê–ñ–î–û–ì–û –°–í–û–ô–°–¢–í–ê –ö–û–¢–û–†–û–ï –ú–û–ñ–ï–¢ –°–û–ó–î–ê–í–ê–¢–¨ –ö–†–ê–°–ù–´–ï –õ–ò–ù–ò–ò
      injectHighPriorityStyle(`
        /* –ü–û–õ–ù–û–ï –£–î–ê–õ–ï–ù–ò–ï –ë–û–õ–¨–®–ò–• –õ–ò–ù–ò–ô (–ú–ï–¢–û–î 2) */
        
        /* –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–∞–∂–¥–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–Ω—ã–µ –ª–∏–Ω–∏–∏ */
        .monaco-editor *[class*="error"],
        .monaco-editor *[class*="warning"],
        .monaco-editor *[class*="squiggly"],
        .monaco-editor *[class*="diagnostic"],
        .monaco-editor *[class*="cdr"],
        .monaco-editor *[class*="cslr"],
        .monaco-editor .view-overlays > div,
        .monaco-editor .view-overlays .view-line,
        .monaco-editor .view-lines .view-line,
        .monaco-editor .lines-content .view-line,
        .monaco-editor .margin .margin-view-overlays .line-delete,
        .monaco-editor .margin .margin-view-overlays .line-insert {
          background: transparent !important;
          background-color: transparent !important;
          border-top: none !important;
          border-bottom: none !important;
          border-left: none !important;
          border-right: none !important;
          outline: none !important;
          text-decoration: none !important;
          box-shadow: none !important;
          opacity: 1 !important;
        }
        
        /* –û—Å–æ–±—ã–π —Å–ª—É—á–∞–π - —Ä–µ–¥–∞–∫—Ç–æ—Ä Python –ø–æ–ª–Ω–æ—Å—Ç—å—é –±–ª–æ–∫–∏—Ä—É–µ–º –∫—Ä–∞—Å–Ω—ã–µ –ª–∏–Ω–∏–∏ */
        .monaco-editor[data-mode="python"] .view-line,
        .monaco-editor[data-mode="python"] .view-lines > div,
        .monaco-editor[data-mode="python"] .view-overlays > div {
          background: transparent !important;
          background-color: transparent !important;
        }
      `);
      
      // –ú–ï–¢–û–î 3: –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï CASE –î–õ–Ø –ö–ê–ñ–î–û–ì–û –ö–û–ù–ö–†–ï–¢–ù–û–ì–û –í–ò–î–ê –î–ï–ö–û–†–ê–¶–ò–ò
      injectHighPriorityStyle(`
        /* –ü–û–õ–ù–û–ï –£–î–ê–õ–ï–ù–ò–ï –ë–û–õ–¨–®–ò–• –õ–ò–ù–ò–ô (–ú–ï–¢–û–î 3) */
        
        /* –ë–ª–æ–∫–∏—Ä—É–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–µ–∫–æ—Ä–∞—Ü–∏–π –ª–∏–Ω–∏–π */
        .monaco-editor .view-overlays .current-line,
        .monaco-editor .view-overlays .current-line-both,
        .monaco-editor .view-overlays .line-with-error,
        .monaco-editor .view-overlays .error-line,
        .monaco-editor .view-overlays .warning-line,
        .monaco-editor .view-overlays .current-diagnostic-row,
        .monaco-editor .view-overlays .diagonal-fill,
        .monaco-editor .view-overlays .error-widget {
          background: transparent !important;
          background-color: transparent !important;
          border: none !important;
          box-shadow: none !important;
        }
        
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º –≤–Ω—É—Ç—Ä–∏—Å—Ç—Ä–æ—á–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .monaco-editor .mtk-error,
        .monaco-editor .mtk-warn,
        .monaco-editor .mtki,
        .monaco-editor .mtku {
          background: transparent !important;
          text-decoration: none !important;
          font-style: normal !important;
          font-weight: normal !important;
        }
        
        /* –î–ª—è —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è - —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ inline —Å—Ç–∏–ª–∏ */
        .monaco-editor .view-line span[style*="background"],
        .monaco-editor .view-line span[style*="border"],
        .monaco-editor .view-line span[style*="decoration"] {
          background: transparent !important;
          background-color: transparent !important;
          border: none !important;
          text-decoration: none !important;
        }
      `);
      
      // –ú–ï–¢–û–î 4: –ò–ù–ñ–ï–ö–¶–ò–Ø JAVASCRIPT –î–õ–Ø –ê–ö–¢–ò–í–ù–û–ì–û –ò–ó–ú–ï–ù–ï–ù–ò–Ø DOM
      const cleanupAllErrorBackgrounds = () => {
        // 1. –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        const viewLines = document.querySelectorAll('.monaco-editor .view-line, .monaco-editor .view-overlays > div');
        viewLines.forEach(line => {
          if (line instanceof HTMLElement) {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è —Ñ–æ–Ω–∞
            line.style.background = 'transparent';
            line.style.backgroundColor = 'transparent';
            line.style.borderTop = 'none';
            line.style.borderBottom = 'none';
            line.style.boxShadow = 'none';
            
            // –£–¥–∞–ª—è–µ–º –ª—é–±—ã–µ –∫–ª–∞—Å—Å—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –æ—à–∏–±–∫–∞–º–∏
            if (line.className) {
              line.className = line.className
                .replace(/error/g, '')
                .replace(/warning/g, '')
                .replace(/squiggly/g, '')
                .replace(/cdr/g, '')
                .replace(/cslr/g, '')
                .replace(/diagnostic-row/g, '');
            }
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            const spans = line.querySelectorAll('span');
            spans.forEach(span => {
              if (span instanceof HTMLElement) {
                span.style.background = 'transparent';
                span.style.backgroundColor = 'transparent';
                span.style.borderBottom = 'none';
                span.style.textDecoration = 'none';
                span.style.boxShadow = 'none';
              }
            });
          }
        });
        
        // 2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å –∫–ª–∞—Å—Å–∞–º–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å –æ—à–∏–±–∫–∞–º–∏
        document.querySelectorAll('.monaco-editor [class*="error"], .monaco-editor [class*="warning"], .monaco-editor [class*="squiggly"]')
          .forEach(el => {
            if (el instanceof HTMLElement) {
              el.style.background = 'transparent';
              el.style.backgroundColor = 'transparent';
              el.style.borderBottom = 'none';
              el.style.boxShadow = 'none';
              el.style.textDecoration = 'none';
            }
          });
      };
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—á–∏—Å—Ç–∫—É —Å—Ä–∞–∑—É
      cleanupAllErrorBackgrounds();
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –æ—á–∏—Å—Ç–∫—É —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∫—Ä–∞—Å–Ω—ã—Ö –ª–∏–Ω–∏–π
      const interval = setInterval(cleanupAllErrorBackgrounds, 100);
      
      // –ß–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ —É–º–µ–Ω—å—à–∞–µ–º —á–∞—Å—Ç–æ—Ç—É –æ—á–∏—Å—Ç–∫–∏
      setTimeout(() => {
        clearInterval(interval);
        setInterval(cleanupAllErrorBackgrounds, 1000);
      }, 5000);
      
      // –ú–ï–¢–û–î 5: MUTATION OBSERVER –î–õ–Ø –ú–û–ú–ï–ù–¢–ê–õ–¨–ù–û–ô –†–ï–ê–ö–¶–ò–ò –ù–ê –ò–ó–ú–ï–ù–ï–ù–ò–Ø DOM
      const setupDomObserver = () => {
        if (typeof MutationObserver === 'undefined') return;
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—á–∏—Å—Ç–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–∞
        const quickCleanup = (element) => {
          if (element instanceof HTMLElement) {
            const classes = element.className || '';
            const hasPotentialErrorClass = 
              classes.includes('error') || 
              classes.includes('warning') || 
              classes.includes('squiggly') ||
              classes.includes('diagnostic') ||
              classes.includes('cdr') ||
              classes.includes('cslr');
            
            // –ï—Å–ª–∏ —ç—Ç–æ —ç–ª–µ–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Å–æ–º –æ—à–∏–±–∫–∏ - –æ—á–∏—â–∞–µ–º –µ–≥–æ
            if (hasPotentialErrorClass) {
              element.style.setProperty('background', 'transparent', 'important');
              element.style.setProperty('background-color', 'transparent', 'important');
              element.style.setProperty('border', 'none', 'important');
              element.style.setProperty('box-shadow', 'none', 'important');
              element.style.setProperty('text-decoration', 'none', 'important');
              return;
            }
            
            // –ï—Å–ª–∏ —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ - –≤—Å–µ–≥–¥–∞ –æ—á–∏—â–∞–µ–º
            if (
              element.classList.contains('view-line') || 
              (element.parentElement && element.parentElement.classList.contains('view-overlays'))
            ) {
              element.style.setProperty('background', 'transparent', 'important');
              element.style.setProperty('background-color', 'transparent', 'important');
            }
          }
        };
        
        // –°–æ–∑–¥–∞–µ–º observer
        const observer = new MutationObserver(mutations => {
          mutations.forEach(mutation => {
            // –†–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤
            if (mutation.type === 'attributes' && 
                (mutation.attributeName === 'class' || mutation.attributeName === 'style')) {
              quickCleanup(mutation.target);
            }
            
            // –†–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            if (mutation.type === 'childList' && mutation.addedNodes.length) {
              mutation.addedNodes.forEach(node => {
                if (node instanceof HTMLElement) {
                  quickCleanup(node);
                  
                  // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                  node.querySelectorAll('*').forEach(el => quickCleanup(el));
                }
              });
            }
          });
        });
        
        // –ù–∞–±–ª—é–¥–∞–µ–º –∑–∞ –≤—Å–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º
        observer.observe(document.body, {
          childList: true,
          subtree: true,
          attributes: true,
          attributeFilter: ['class', 'style']
        });
        
        return observer;
      };
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è –∑–∞ DOM
      setupDomObserver();
      
      // –ú–ï–¢–û–î 6: –°–õ–£–®–ê–¢–ï–õ–ò –°–û–ë–´–¢–ò–ô –†–ï–î–ê–ö–¢–û–†–ê –î–õ–Ø –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ô –†–ï–ê–ö–¶–ò–ò
      const setupEditorListeners = () => {
        if (!window.monaco || !window.monaco.editor) return;
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –º–æ–¥–µ–ª–∏
        window.monaco.editor.onDidChangeModelContent(() => {
          setTimeout(cleanupAllErrorBackgrounds, 0);
          setTimeout(cleanupAllErrorBackgrounds, 50);
          setTimeout(cleanupAllErrorBackgrounds, 100);
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –∫—É—Ä—Å–æ—Ä–∞
        window.monaco.editor.onDidChangeCursorPosition(() => {
          setTimeout(cleanupAllErrorBackgrounds, 0);
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
        window.addEventListener('python-diagnostics-updated', () => {
          setTimeout(cleanupAllErrorBackgrounds, 0);
          setTimeout(cleanupAllErrorBackgrounds, 100);
          setTimeout(cleanupAllErrorBackgrounds, 200);
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        window.monaco.editor.onDidCreateEditor(editor => {
          setTimeout(cleanupAllErrorBackgrounds, 0);
          
          if (editor && editor.onDidChangeModelContent) {
            editor.onDidChangeModelContent(() => {
              setTimeout(cleanupAllErrorBackgrounds, 0);
            });
          }
        });
      };
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
      setupEditorListeners();
      
      // –ú–ï–¢–û–î 7: –ü–ï–†–ï–•–í–ê–¢ API MONACO –î–õ–Ø –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–Ø –î–û–ë–ê–í–õ–ï–ù–ò–Ø –î–ï–ö–û–†–ê–¶–ò–ô –û–®–ò–ë–û–ö
      const overrideMonacoAPI = () => {
        if (!window.monaco || !window.monaco.editor) return;
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
        const originalDeltaDecorations = window.monaco.editor.ITextModel.prototype.deltaDecorations;
        
        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–æ–¥ deltaDecorations, —á—Ç–æ–±—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ü–∏–∏ –æ—à–∏–±–æ–∫
        window.monaco.editor.ITextModel.prototype.deltaDecorations = function(oldDecorations, newDecorations) {
          // –§–∏–ª—å—Ç—Ä—É–µ–º –¥–µ–∫–æ—Ä–∞—Ü–∏–∏, —É–¥–∞–ª—è—è —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–Ω—ã–µ –ª–∏–Ω–∏–∏
          const filteredDecorations = newDecorations.filter(decoration => {
            if (!decoration || !decoration.options) return true;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –¥–µ–∫–æ—Ä–∞—Ü–∏—é –æ—à–∏–±–∫–∏
            const className = decoration.options.className || '';
            const inlineClassName = decoration.options.inlineClassName || '';
            const hoverMessage = decoration.options.hoverMessage;
            
            const isErrorDecoration = 
              (className && (className.includes('error') || className.includes('warning'))) ||
              (inlineClassName && (inlineClassName.includes('error') || inlineClassName.includes('warning'))) ||
              decoration.options.isWholeLine === true;
            
            // –ï—Å–ª–∏ —ç—Ç–æ –¥–µ–∫–æ—Ä–∞—Ü–∏—è –æ—à–∏–±–∫–∏, –Ω–æ –Ω–µ –Ω–∞—à–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ - —Ñ–∏–ª—å—Ç—Ä—É–µ–º
            if (isErrorDecoration && 
                !inlineClassName.includes('thin-error-underline') && 
                !inlineClassName.includes('thin-warning-underline')) {
              return false;
            }
            
            return true;
          });
          
          // –í—ã–∑—ã–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ —Å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏—è–º–∏
          return originalDeltaDecorations.call(this, oldDecorations, filteredDecorations);
        };
      };
      
      // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º API Monaco –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–µ–∫–æ—Ä–∞—Ü–∏–π –æ—à–∏–±–æ–∫
      try {
        overrideMonacoAPI();
      } catch (e) {
        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å API Monaco:', e);
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ —Ç–æ–Ω–∫–∏—Ö –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–π
    function applyOnlyUnderlineDecorations(editor) {
      if (!editor || !editor.getModel) return;
      
      const model = editor.getModel();
      if (!model) return;
      
      // –û—á–∏—â–∞–µ–º –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      const allDecorations = editor.getModel().getAllDecorations();
      const ids = allDecorations.map(d => d.id);
      editor.deltaDecorations(ids, []);
      
      // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ –º–∞—Ä–∫–µ—Ä—ã –æ—à–∏–±–æ–∫
      const markers = monaco.editor.getModelMarkers({ resource: model.uri })
        .filter(marker => marker.severity === monaco.MarkerSeverity.Error || 
                          marker.severity === monaco.MarkerSeverity.Warning);
      
      if (!markers || markers.length === 0) return;
      
      // –°–æ–∑–¥–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–Ω–∫–∏–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
      const decorations = markers.map(marker => {
        // –°–æ–∑–¥–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
        const range = new monaco.Range(
          marker.startLineNumber,
          marker.startColumn,
          marker.endLineNumber,
          marker.endColumn
        );
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏
        const isError = marker.severity === monaco.MarkerSeverity.Error;
        
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–Ω–∫–æ–µ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ –±–µ–∑ —Ñ–æ–Ω–∞ —Å—Ç—Ä–æ–∫–∏
        return {
          range: range,
          options: {
            inlineClassName: isError ? 'thin-error-underline' : 'thin-warning-underline',
            hoverMessage: { value: marker.message },
            // –í–∞–∂–Ω–æ: –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º isWholeLine
            isWholeLine: false,
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –Ω–∞ –º–∏–Ω–∏-–∫–∞—Ä—Ç–µ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
            minimap: {
              color: isError ? '#FF4C4C' : '#FFCC00',
              position: monaco.editor.MinimapPosition.Inline
            },
            // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É –Ω–∞ –ø–æ–ª–æ—Å–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            overviewRuler: {
              color: isError ? '#FF4C4C' : '#FFCC00',
              position: monaco.editor.OverviewRulerLane.Right
            }
          }
        };
      });
      
      // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞—à–∏ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      editor.deltaDecorations([], decorations);
      
      // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
      editor.updateOptions({
        lineHeight: 18,
        glyphMargin: true,
        lineDecorationsWidth: 10
      });
      
      // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
      editor.layout();
      
      // –ê–∫—Ç–∏–≤–Ω–æ –æ—á–∏—â–∞–µ–º –ª—é–±—ã–µ –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ–∫–æ—Ä–∞—Ü–∏–∏
      setTimeout(() => {
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—á–∏—â–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ –æ—Ç —Ñ–æ–Ω–∞
        const viewportElement = editor.getDomNode()?.querySelector('.view-lines');
        if (viewportElement instanceof HTMLElement) {
          const lines = viewportElement.querySelectorAll('.view-line');
          lines.forEach(line => {
            if (line instanceof HTMLElement) {
              line.style.background = 'transparent';
              line.style.backgroundColor = 'transparent';
            }
          });
        }
      }, 10);
    }

    return true;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Python:', error);
    return false;
  }
}